<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>爬虫进阶 | Bang's Blog</title><meta name="author" content="Bang"><meta name="copyright" content="Bang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="爬虫进阶爬虫一定要找最新的教程，因为网站更新速度很快，老版教程很可能会过时，一些案例基本无法复现 爬虫概述  ​                                     静态页面抓取： 获取构造需要抓取的所有url列表 遍历这个列表，使用request等抓取页面数据 使用xpath+Scrapy Selector或者Xpath+lxml的方式对抓取的页面内容进行解析 xpath的编">
<meta property="og:type" content="article">
<meta property="og:title" content="爬虫进阶">
<meta property="og:url" content="https://bangwu2001.github.io/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/index.html">
<meta property="og:site_name" content="Bang&#39;s Blog">
<meta property="og:description" content="爬虫进阶爬虫一定要找最新的教程，因为网站更新速度很快，老版教程很可能会过时，一些案例基本无法复现 爬虫概述  ​                                     静态页面抓取： 获取构造需要抓取的所有url列表 遍历这个列表，使用request等抓取页面数据 使用xpath+Scrapy Selector或者Xpath+lxml的方式对抓取的页面内容进行解析 xpath的编">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://bangwu2001.github.io/img/post/post_1.jpg">
<meta property="article:published_time" content="2024-05-21T14:57:42.000Z">
<meta property="article:modified_time" content="2024-06-04T14:57:16.434Z">
<meta property="article:author" content="Bang">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bangwu2001.github.io/img/post/post_1.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://bangwu2001.github.io/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":5,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Bang","link":"链接: ","source":"来源: Bang's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '爬虫进阶',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-04 22:57:16'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Bang's Blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/logo.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">80</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">25</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/post/post_1.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Bang's Blog"></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">爬虫进阶</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-05-21T14:57:42.000Z" title="发表于 2024-05-21 22:57:42">2024-05-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-06-04T14:57:16.434Z" title="更新于 2024-06-04 22:57:16">2024-06-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>56分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="爬虫进阶"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="爬虫进阶"><a href="#爬虫进阶" class="headerlink" title="爬虫进阶"></a>爬虫进阶</h1><p>爬虫一定要找最新的教程，因为网站更新速度很快，老版教程很可能会过时，一些案例基本无法复现</p>
<h2 id="爬虫概述"><a href="#爬虫概述" class="headerlink" title="爬虫概述"></a>爬虫概述</h2><p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240515215806526.png" alt="image-20240515215806526" style="zoom:33%;"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240515220426489.png" alt="image-20240515220426489" style="zoom: 50%;"></p>
<p>​                                    <img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240515220603409.png" alt="image-20240515220603409" style="zoom: 50%;"></p>
<h2 id="静态页面抓取："><a href="#静态页面抓取：" class="headerlink" title="静态页面抓取："></a>静态页面抓取：</h2><ol>
<li>获取构造需要抓取的所有url列表</li>
<li>遍历这个列表，使用request等抓取页面数据</li>
<li>使用xpath+Scrapy Selector或者Xpath+lxml的方式对抓取的页面内容进行解析<ol>
<li>xpath的编写可以借助浏览器来完成，选中对应元素右键点击copy as xpath</li>
</ol>
</li>
</ol>
<h2 id="request构造请求："><a href="#request构造请求：" class="headerlink" title="request构造请求："></a>request构造请求：</h2><ul>
<li>get请求：<ul>
<li>方式一：url+参数拼接方式</li>
<li>方式二：url+params形参的方式</li>
</ul>
</li>
<li>post请求<ul>
<li>许多登陆页面，需要通过构造post请求，提交信息，破除限制 </li>
<li>可以通过form-data或者json的形式提交数据</li>
</ul>
</li>
</ul>
<h2 id="模拟登陆场景："><a href="#模拟登陆场景：" class="headerlink" title="模拟登陆场景："></a>模拟登陆场景：</h2><p>许多网站必须登陆之后才能访问里面其他的页面</p>
<ol>
<li>通过抓包，找到登陆接口</li>
<li>编写代码请求登陆接口，传入正确的账号、密码等信息</li>
</ol>
<p>即使登陆之后，仍然可以访问其他页面吗？不一定，这时我们要关注后台的鉴权方式</p>
<p>后台的鉴权方式一般有两种：</p>
<ul>
<li>基于cookie+session的鉴权机制</li>
<li>基于Token的鉴权机制<ul>
<li><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516004458958.png" alt="image-20240516004458958" style="zoom:50%;"></li>
</ul>
</li>
</ul>
<p>如何初步判断是采用的哪种鉴权？</p>
<ul>
<li>form-data大概率是cookie+session</li>
<li>网站首页地址与登陆请求地址不一致，大概率是token鉴权</li>
</ul>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516005245589.png" alt="image-20240516005245589" style="zoom:67%;"></p>
<h3 id="模拟登录中华网"><a href="#模拟登录中华网" class="headerlink" title="模拟登录中华网"></a>模拟登录中华网</h3><p>模拟登录、访问需要登录之后才能够访问的页面</p>
<ul>
<li>1发送登录请求</li>
<li>保存cookie信息</li>
<li>下次请求需要登录页面直接携带cookie信息</li>
</ul>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">中华网账号 https://passport.china.com/</span><br><span class="line">username:17775990925</span><br><span class="line">password:a546245426</span><br></pre></td></tr></table></figure>
<p>通过抓包找到登录接口地址，注意这里用错误的账号或者密码，如果是正确的则会自动跳转，无法找出登录接口</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516102343020.png" alt="image-20240516102343020" style="zoom:80%;"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516102405228.png" alt="image-20240516102405228"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516102418641.png" alt="image-20240516102418641"></p>
<p>利用python构造请求模拟登录实例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment">#url</span></span><br><span class="line">url = <span class="string">&quot;https://passport.china.com/logon&quot;</span></span><br><span class="line"><span class="comment">#请求头</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;https://passport.china.com/logon&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">#请求参数</span></span><br><span class="line">params=&#123;</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;17775990925&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;a546245426&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#模拟登录请求</span></span><br><span class="line"><span class="comment"># login_response = requests.post(url,data=params,headers=headers)</span></span><br><span class="line"><span class="comment"># print(login_response.content.decode(&quot;utf8&quot;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(login_response.cookies)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">如何提取请求的cookie信息:</span></span><br><span class="line"><span class="string">    response.cookies</span></span><br><span class="line"><span class="string">如何解决利用cookie进行校验的访问请求:</span></span><br><span class="line"><span class="string">    方式一: </span></span><br><span class="line"><span class="string">        request.get(cookies=cookies)，利用参数让请求携带cookie信息,cookie字典格式</span></span><br><span class="line"><span class="string">    方式二:</span></span><br><span class="line"><span class="string">        请求头中携带,cookie以字符串格式</span></span><br><span class="line"><span class="string">        headers=&#123;</span></span><br><span class="line"><span class="string">            &quot;Cookie&quot;:cookie值</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    方式三：requests.session</span></span><br><span class="line"><span class="string">    利用:</span></span><br><span class="line"><span class="string">        requests.session()对象去发送请求，其会自动记住状态信息</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#访问其他页面,不携带cookie信息的话会自动跳转到登录页面</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#方式一：以字典的形式传递</span></span><br><span class="line"><span class="comment"># url = &quot;https://passport.china.com&quot;</span></span><br><span class="line"><span class="comment"># response = requests.get(url,headers=headers,cookies=login_response.cookies)</span></span><br><span class="line"><span class="comment"># print(response.content.decode())</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#方式二：以字符串的形式传递</span></span><br><span class="line"><span class="comment">#这种cookie来源:直接从浏览器复制</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># headers[&quot;Cookie&quot;]=&#x27;area_name=%E6%B9%96%E5%8C%97%E7%9C%81%E6%AD%A6%E6%B1%89%E5%B8%82; SESSION_COOKIE=46; Hm_lvt_cbec92dec763e6774898d6d85460f707=1715822413,1715828314; Hm_lpvt_cbec92dec763e6774898d6d85460f707=1715828314; nickname=china_2823hxfg16791058; lastlogindate=2024-05-16; lastlogintime=&quot;10:58:48&quot;; lastloginip=211.161.157.200; bindMobile=&quot;1@177*****925&quot;; CHINACOMID=218ab446-115d-4fbe-93fe-a5fd744593825; CP_USER=FKBo6w-aaDELXK1EnoT3DPk1faoTCuWOzIpsuaQNIsJWqiRz6o9drrZQMJZRRbngi7eJikd0sv41eZDrzksZGmumfJyC7TEP5dMN41%2F1QIHag0K39t%2FVBxzGqQTN85yGmV%2FbilYB7ulfPMYVXbF6aMqwUoU1rfChWCxyzGnnrK%2FgdpLc0L1F5tS7hOqvGEkrBP23Gu2Sd0E76gm7%2FHCqgRxwGcN7FXOpmlLJ6WjemIAiC44IuLq2ow%3D%3D; CP_USERINFO=4Gkk4uas%2FGU6V4cAn8Kr14YtZHaRsQ3bb0iKxhYvuaLYLT-rPEFbvbaQzjvqSKm2v8Fd1lQ14weg0PM1aAxGqjzFStaNWwdXEhS3Zzs0jusNqPIZSkWIUHBpa7NyrsBUv2O8QVvh3O4yqW9wAjnfpw%3D%3D; china_variable=jpEe7N32pYz8SAjCjL8fnh2eLZiI1D/EC6dYmS6/lLUOPrHJGj-IxLIHbACvhNcaC9z3Z8pi2hy0JtYoQGGXmsutg32di8lhAZaSKKJ8BFBt-lJZl7B3R-LY1hWhKpza; lastlogindate=2024-05-16; lastlogintime=&quot;10:58:48&quot;; lastloginip=211.161.157.200&#x27;</span></span><br><span class="line"><span class="comment"># response = requests.get(url,headers=headers)</span></span><br><span class="line"><span class="comment"># print(response.content.decode())</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#方式三: requests.session</span></span><br><span class="line">login_url = <span class="string">&quot;https://passport.china.com/logon&quot;</span></span><br><span class="line">main_url = <span class="string">&quot;https://passport.china.com&quot;</span></span><br><span class="line">session = requests.session()</span><br><span class="line"><span class="comment">#登录</span></span><br><span class="line">session.post(login_url,data=params,headers=headers)</span><br><span class="line"><span class="comment">#访问其他页面,整个过程处于同一会话</span></span><br><span class="line">response = session.get(main_url,headers=headers)</span><br><span class="line"><span class="built_in">print</span>(response.content.decode())</span><br></pre></td></tr></table></figure>
<h2 id="Ajax异步数据"><a href="#Ajax异步数据" class="headerlink" title="Ajax异步数据"></a>Ajax异步数据</h2><p>背景：大对数网站采用前后端分离方式构建应用，数据都是通过Ajax请求异步加载获取的，直接请求目标网站的话，返回的内容中压根就没有任何数据</p>
<p>比如对于东方财富：<a target="_blank" rel="noopener" href="https://quote.eastmoney.com/center">https://quote.eastmoney.com/center</a></p>
<p>浏览器抓包分析，发现页面数据根本不在请求返回的html文件中，他的数据都是通过异步请求得到的</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516111515843.png" alt="image-20240516111515843"></p>
<p>对于这类型的网站，抓取数据的地址根本不是页面上的地址,因为html中压根就没有数据，我们要去分析其发送的AJAX请求，获取对应的URL，然后去抓取对应的数据</p>
<h3 id="异步数据抓取案例"><a href="#异步数据抓取案例" class="headerlink" title="异步数据抓取案例"></a>异步数据抓取案例</h3><p>我们选取<a target="_blank" rel="noopener" href="https://careers.tencent.com/home.html">腾讯招聘</a>网站作为爬取目标，我们可以发现它的网站职位数据就是异步加载的</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516144559312.png" alt="image-20240516144559312"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">url:https://careers.tencent.com/tencentcareer/api/post/Query</span></span><br><span class="line"><span class="string">请求参数:</span></span><br><span class="line"><span class="string">    timestamp: 1715841296996</span></span><br><span class="line"><span class="string">    countryId:</span></span><br><span class="line"><span class="string">    cityId:</span></span><br><span class="line"><span class="string">    bgIds:</span></span><br><span class="line"><span class="string">    productId:</span></span><br><span class="line"><span class="string">    categoryId:</span></span><br><span class="line"><span class="string">    parentCategoryId:</span></span><br><span class="line"><span class="string">    attrId:</span></span><br><span class="line"><span class="string">    keyword:</span></span><br><span class="line"><span class="string">    pageIndex: 1</span></span><br><span class="line"><span class="string">    pageSize: 10</span></span><br><span class="line"><span class="string">    language: zh-cn</span></span><br><span class="line"><span class="string">    area: cn</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">base_url = <span class="string">&quot;https://careers.tencent.com/tencentcareer/api/post/Query&quot;</span></span><br><span class="line">params=&#123;</span><br><span class="line">    <span class="string">&quot;timestamp&quot;</span>: <span class="number">1715841296996</span>,</span><br><span class="line">    <span class="string">&quot;countryId&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cityId&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;bgIds&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;productId&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;categoryId&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;parentCategoryId&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;attrId&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;keyword&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pageIndex&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;pageSize&quot;</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="string">&quot;language&quot;</span>: <span class="string">&quot;zh-cn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;area&quot;</span>: <span class="string">&quot;cn&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#分页抓取:</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">可变的参数:</span></span><br><span class="line"><span class="string"> pageIndex以及timestamp</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> pageIndex <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    params[<span class="string">&quot;timestamp&quot;</span>] = <span class="built_in">int</span>(time.time()*<span class="number">1000</span>)</span><br><span class="line">    params[<span class="string">&quot;pageIndex&quot;</span>] = pageIndex</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">10</span>,<span class="string">&quot;current pageInde:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(pageIndex),<span class="string">&quot;=&quot;</span>*<span class="number">10</span>)</span><br><span class="line">    response = requests.get(url=base_url,params=params)</span><br><span class="line">    <span class="comment">#转换为json格式</span></span><br><span class="line">    result_data = response.json()</span><br><span class="line">    job_count = result_data[<span class="string">&quot;Data&quot;</span>][<span class="string">&quot;Count&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> job_count==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    job_list = result_data[<span class="string">&quot;Data&quot;</span>][<span class="string">&quot;Posts&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> job <span class="keyword">in</span> job_list:</span><br><span class="line">        <span class="built_in">print</span>(job[<span class="string">&quot;RecruitPostName&quot;</span>])</span><br><span class="line"><span class="comment">#数据后续可以根据具体业务需求，保存在本地文件或者数据库中   </span></span><br></pre></td></tr></table></figure>
<h2 id="数据格式转换问题"><a href="#数据格式转换问题" class="headerlink" title="数据格式转换问题"></a>数据格式转换问题</h2><p>有些网站，我们抓取时，响应返回的数据形式比较复杂，我们如何从中快速提取想要的数据</p>
<p>对于非结构化数据：HTML</p>
<ul>
<li>用正则表达式、xpath等手段处理</li>
</ul>
<p>对于结构化数据：json、xml等</p>
<ul>
<li>直接转换为python类型</li>
</ul>
<h3 id="json模块"><a href="#json模块" class="headerlink" title="json模块"></a>json模块</h3><p>json.loads</p>
<ul>
<li>把json格式字符串解码转换成python对象，json数组对应列表、json对象对应字典</li>
<li>python中的None，在json中用null表示</li>
</ul>
<p>json.dumps</p>
<ul>
<li>实现把python类型转换为json字符串，返回一个str对象，是把python对象编码成json字符串</li>
<li>其序列化默认采用ascii编码</li>
<li>添加参数 ensure_ascii=False禁用ascii编码，按utf-8编码</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37806690/article/details/137988296">python json转换参考资料</a></p>
<h3 id="jsonPath"><a href="#jsonPath" class="headerlink" title="jsonPath"></a>jsonPath</h3><p>正如XPath之于XML文档一样，JsonPath为Json文档提供了解析能力，通过使用JsonPath，你可以方便的查找节点、获取想要的数据，JsonPath是Json版的XPath</p>
<p>其用法基本跟xpath一致</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/youring2/p/10942728.html">参考资料</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3f5b9cc88bde">python jsonpath教程</a></p>
<h3 id="案例：jsonpath进行数据提取"><a href="#案例：jsonpath进行数据提取" class="headerlink" title="案例：jsonpath进行数据提取"></a>案例：jsonpath进行数据提取</h3><p>目标网站<a target="_blank" rel="noopener" href="https://www.xfz.cn/">小饭桌</a>，我们提取各个咨询的标题、发布作者、发布事件信息</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516153253078.png" alt="image-20240516153253078"></p>
<p>其响应数据格式如下图所示：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="number">10918</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;智愈医疗完成超6000万元Pre-A++轮融资&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;photo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://static-image.xfz.cn/1715658195_783.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;photo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://static-image.xfz.cn/1552965456_492.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;authors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;author_id&quot;</span><span class="punctuation">:</span> <span class="number">500</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;饭桌君&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;is_original&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;article_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;融资消息&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;intro&quot;</span><span class="punctuation">:</span> <span class="string">&quot;由辰德资本领投，联想之星跟投，老股东顺为资本、礼来亚洲基金、众海投资持续加注。凡卓资本担任本轮融资独家财务顾问。&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-05-14 11:43:15&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;keywords&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;智愈医疗&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>我们需要从中解析出我们想要的数据</p>
<p>我们首先抓包，分析其数据异步加载的接口以及对应的请求参数，分析不同分页url和请求参数的规律</p>
<p>其请求的数据</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516153515923.png" alt="image-20240516153515923"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516153529052.png" alt="image-20240516153529052"></p>
<p><strong>python代码</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;uid&quot;: 10874,</span></span><br><span class="line"><span class="string">    &quot;title&quot;: &quot;与微软合作，这家独角兽让GPT对中国企业开放了&quot;,</span></span><br><span class="line"><span class="string">    &quot;photo&quot;: &quot;https://static-image.xfz.cn/1708917564_964.jpg&quot;,</span></span><br><span class="line"><span class="string">    &quot;author&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;photo&quot;: &quot;https://static-image.xfz.cn/1693983197_842.jpg&quot;,</span></span><br><span class="line"><span class="string">        &quot;authors&quot;: [</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                &quot;author_id&quot;: 2295,</span></span><br><span class="line"><span class="string">                &quot;name&quot;: &quot;黄泽正&quot;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;is_original&quot;: true,</span></span><br><span class="line"><span class="string">    &quot;article_type&quot;: &quot;热点&quot;,</span></span><br><span class="line"><span class="string">    &quot;intro&quot;: &quot;中国企业合法合规使用GPT的时代，终于来了。&quot;,</span></span><br><span class="line"><span class="string">    &quot;source&quot;: &quot;&quot;,</span></span><br><span class="line"><span class="string">    &quot;time&quot;: &quot;2024-02-26 11:19:24&quot;,</span></span><br><span class="line"><span class="string">    &quot;keywords&quot;: [</span></span><br><span class="line"><span class="string">        &quot;GPT&quot;,</span></span><br><span class="line"><span class="string">        &quot;易点云&quot;,</span></span><br><span class="line"><span class="string">        &quot;IT综合解決方案供应商&quot;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> jsonpath</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&quot;https://www.xfz.cn/api/website/articles/&quot;</span></span><br><span class="line">params=&#123;</span><br><span class="line">    <span class="string">&quot;p&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&quot;n&quot;</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    params[<span class="string">&quot;p&quot;</span>]=p</span><br><span class="line">    response = requests.get(url=base_url,params=params)</span><br><span class="line">    response_json = response.json()</span><br><span class="line">    <span class="comment">#提取感兴趣信息</span></span><br><span class="line">    <span class="comment">#文章标题</span></span><br><span class="line">    title_list = jsonpath.jsonpath(response_json,<span class="string">&quot;$..title&quot;</span>)</span><br><span class="line">    <span class="comment">#文章作者</span></span><br><span class="line">    author_list = jsonpath.jsonpath(response_json,<span class="string">&quot;$..author..name&quot;</span>)</span><br><span class="line">    <span class="comment">#发布时间</span></span><br><span class="line">    time_list = jsonpath.jsonpath(response_json,<span class="string">&quot;$..time&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> title,author,time <span class="keyword">in</span> <span class="built_in">zip</span>(title_list,author_list,time_list):</span><br><span class="line">        <span class="built_in">print</span>(title,<span class="string">&quot;\t&quot;</span>,author,<span class="string">&quot;\t&quot;</span>,time)</span><br></pre></td></tr></table></figure>
<h2 id="视频抓取"><a href="#视频抓取" class="headerlink" title="视频抓取"></a>视频抓取</h2><h3 id="B站视频抓取"><a href="#B站视频抓取" class="headerlink" title="B站视频抓取"></a>B站视频抓取</h3><h4 id="资源抓取"><a href="#资源抓取" class="headerlink" title="资源抓取"></a>资源抓取</h4><p>B站视频的画面和音频是通过不同的url来异步请求获取，所以我们抓包分析得到画面和音频的请求链接，然后分别抓取画面和音频，最后在本地将两者合成视频文件</p>
<p>抓包分析，最开始的两个请求即为画面和音频资源请求</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516182906785.png" alt="image-20240516182906785"></p>
<h4 id="视频合成"><a href="#视频合成" class="headerlink" title="视频合成"></a>视频合成</h4><p>MoviePy是一个用于视频编辑的Python模块，它可以用于一些基本操作，比如剪切、拼接、插入标题、视频合成、视频处理和创建高级特效</p>
<p><a target="_blank" rel="noopener" href="https://moviepy-cn.readthedocs.io/zh/latest/">官网教程</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/680555324">参考博客</a></p>
<h4 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例:"></a>代码示例:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">分析：</span></span><br><span class="line"><span class="string">    对于B站而言，其视频和音频内容是分开请求的，最终的视频是由两者一起合成的</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">注意:经过验证，如果不携带User-Agent和Referer这两个请求头，会直接返回403 forbidden</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Referer&quot;</span>:<span class="string">&quot;https://www.bilibili.com/video/BV1Mp421m7Ck/?spm_id_from=333.1007.tianma.1-1-1.click&amp;vd_source=91a99cf2cdc8a7bec61c79b14c7a9800&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">url1=<span class="string">&quot;https://cn-hbwh-fx-01-13.bilivideo.com/upgcxcode/03/12/1475871203/1475871203-1-100026.m4s?e=ig8euxZM2rNcNbdlhoNvNC8BqJIzNbfqXBvEqxTEto8BTrNvN0GvT90W5JZMkX_YN0MvXg8gNEV4NC8xNEV4N03eN0B5tZlqNxTEto8BTrNvNeZVuJ10Kj_g2UB02J0mN0B5tZlqNCNEto8BTrNvNC7MTX502C8f2jmMQJ6mqF2fka1mqx6gqj0eN0B599M=&amp;uipk=5&amp;nbs=1&amp;deadline=1715855097&amp;gen=playurlv2&amp;os=bcache&amp;oi=1939666239&amp;trid=00002988359d2ffb4c87ad295bbe92858e17u&amp;mid=503787920&amp;platform=pc&amp;upsig=9252145cbb94964367b3213d88a75b0f&amp;uparams=e,uipk,nbs,deadline,gen,os,oi,trid,mid,platform&amp;cdnid=3881&amp;bvc=vod&amp;nettype=0&amp;orderid=0,3&amp;buvid=FEF21EE4-4208-C79B-80F6-27AC2A9BBD3459139infoc&amp;build=0&amp;f=u_0_0&amp;agrr=1&amp;bw=173938&amp;np=151388311&amp;logo=80000000&quot;</span></span><br><span class="line">url2=<span class="string">&quot;https://cn-hbwh-fx-01-12.bilivideo.com/upgcxcode/03/12/1475871203/1475871203-1-30280.m4s?e=ig8euxZM2rNcNbdlhoNvNC8BqJIzNbfqXBvEqxTEto8BTrNvN0GvT90W5JZMkX_YN0MvXg8gNEV4NC8xNEV4N03eN0B5tZlqNxTEto8BTrNvNeZVuJ10Kj_g2UB02J0mN0B5tZlqNCNEto8BTrNvNC7MTX502C8f2jmMQJ6mqF2fka1mqx6gqj0eN0B599M=&amp;uipk=5&amp;nbs=1&amp;deadline=1715855097&amp;gen=playurlv2&amp;os=bcache&amp;oi=1939666239&amp;trid=00002988359d2ffb4c87ad295bbe92858e17u&amp;mid=503787920&amp;platform=pc&amp;upsig=1d8cc071b206465e33d41d8e298308d9&amp;uparams=e,uipk,nbs,deadline,gen,os,oi,trid,mid,platform&amp;cdnid=1237&amp;bvc=vod&amp;nettype=0&amp;orderid=0,3&amp;buvid=FEF21EE4-4208-C79B-80F6-27AC2A9BBD3459139infoc&amp;build=0&amp;f=u_0_0&amp;agrr=1&amp;bw=20005&amp;np=151388311&amp;logo=80000000&quot;</span></span><br><span class="line"></span><br><span class="line">response1 = requests.get(url1,headers=headers)</span><br><span class="line">response2 = requests.get(url2,headers=headers)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;b站1.mp4&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(response1.content)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;b站2.mp4&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(response2.content)</span><br><span class="line"></span><br><span class="line"><span class="comment">#合成视频:画面+音频</span></span><br><span class="line"><span class="keyword">from</span> moviepy.editor <span class="keyword">import</span> ffmpeg_tools</span><br><span class="line">ffmpeg_tools.ffmpeg_merge_video_audio(<span class="string">&quot;b站1.mp4&quot;</span>,<span class="string">&quot;b站2.mp4&quot;</span>,<span class="string">&quot;b站.mp4&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="抖音视频抓取"><a href="#抖音视频抓取" class="headerlink" title="抖音视频抓取"></a>抖音视频抓取</h3><p>我们抓包分析，抖音各个视频的链接都是杂乱无规则的，所以无法用requests批量抓取，如果要批量抓取，只能模拟人来不断点击获取，这个就必须要用到自动化工具selenium了</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516184053032.png" alt="image-20240516184053032"></p>
<p>对于单个视频的下载比较简单，无任何其他的限制，直接发送请求即可获取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;https://v3-weba.douyinvod.com/02263c98b4f10164f58047cc60b11827/6645f1ed/video/tos/cn/tos-cn-ve-15/osB7nDAWI4MQuoB8ECDoeGezOhEs4BbeV2AqM1/?a=6383&amp;ch=5&amp;cr=3&amp;dr=0&amp;lr=all&amp;cd=0%7C0%7C0%7C3&amp;cv=1&amp;br=1199&amp;bt=1199&amp;cs=0&amp;ds=3&amp;ft=kmz2Nvx2llUpoDtWsRdusEBOG4kbZ0Fl~z7avjZmpmPt188HKw9gHlcApW9w6x&amp;mime_type=video_mp4&amp;qs=0&amp;rc=aDk6Omc7ZjY7OTszN2c7Z0BpM3hnNGQ6Zmd4czMzNGkzM0BiLmBiXjZgX14xX2I0NTQ1YSMvYm1ycjRfMy5gLS1kLTBzcw%3D%3D&amp;btag=c0000e00030000&amp;cquery=101s_100B_100x_100z_100a&amp;dy_q=1715855997&amp;feature_id=f0150a16a324336cda5d6dd0b69ed299&amp;l=20240516183955A37ACE947DDB97002DEE&quot;</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;抖音.mp4&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(response.content)</span><br></pre></td></tr></table></figure>
<p>单个视频url无任何规律，所以无法通过代码去批量构造，批量爬取的核心就在于如何批量获取视频的url列表</p>
<h2 id="selenium的使用"><a href="#selenium的使用" class="headerlink" title="selenium的使用"></a>selenium的使用</h2><p><a target="_blank" rel="noopener" href="https://www.selenium.dev/zh-cn/documentation/webdriver/getting_started/">selenium</a>是一个Web的自动化测试工具，最初是为了网站自动化测试而开发的，其可以按照指定的指令自动操作，其可以直接运行在浏览器之上，它支持所有主流的浏览器，模拟人去手动操作浏览器</p>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>我们以<a target="_blank" rel="noopener" href="https://liuyan.people.com.cn/threads/list?checkStatus=0&amp;fid=571&amp;formName=%E6%B9%96%E5%8C%97%E7%9C%81%E5%A7%94%E4%B9%A6%E8%AE%B0%E7%8E%8B%E8%92%99%E5%BE%BD&amp;position=0&amp;province=28&amp;city=&amp;saveLocation=28&amp;pForumNames=%E6%B9%96%E5%8C%97%E7%9C%81">领导留言板</a>这个网站为例，抓取里面的内容，通过抓包获取url，请求参数以及请求等信息，但还是会被拦截</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://liuyan.people.com.cn/v1/threads/list/df&quot;</span></span><br><span class="line"></span><br><span class="line">params=&#123;</span><br><span class="line">  <span class="string">&quot;appCode&quot;</span>: <span class="string">&quot;PC42ce3bfa4980a9&quot;</span>,</span><br><span class="line">  <span class="string">&quot;token&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;signature&quot;</span>: <span class="string">&quot;315b4bdafbf17b3dbb6a48a244b67dff&quot;</span>,</span><br><span class="line">  <span class="string">&quot;param&quot;</span>: <span class="string">&quot;&#123;\&quot;fid\&quot;:\&quot;571\&quot;,\&quot;showUnAnswer\&quot;:1,\&quot;typeId\&quot;:5,\&quot;lastItem\&quot;:\&quot;\&quot;,\&quot;position\&quot;:\&quot;0\&quot;,\&quot;rows\&quot;:10,\&quot;orderType\&quot;:2&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">            <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;&quot;&quot;https://liuyan.people.com.cn/threads/list?checkStatus=0&amp;fid=571&amp;formName=%E6%B9%96%E5%8C%97%E7%9C%81%E5%A7%94%E4%B9%A6%E8%AE%B0%E7%8E%8B%E8%92%99%E5%BE%BD&amp;position=0&amp;province=28&amp;city=&amp;saveLocation=28&amp;pForumNames=%E6%B9%96%E5%8C%97%E7%9C%81&quot;&quot;&quot;</span></span><br><span class="line">            ,<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;__jsluid_s=4b575e53f2419a15d98413b3c2ade788; Hm_lvt_40ee6cb2aa47857d8ece9594220140f1=1715856547; language=zh-CN; deviceId=52e3892d-030a-4de8-8d77-c62c7c0a1a87; Hm_lpvt_40ee6cb2aa47857d8ece9594220140f1=1715856654&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">response = requests.get(url=url,headers=headers,data=params)</span><br><span class="line"><span class="built_in">print</span>(response.content.decode())</span><br></pre></td></tr></table></figure>
<p>响应内容:</p>
<p>其网站内部设置了防护和反扒机制，单纯靠requests是无法处理的，所以这是我们就需要借助于Selenium，模拟人类登录网站的行为，来进行数据的抓取</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">C:<span class="keyword">\environment</span><span class="keyword">\anaconda</span>3<span class="keyword">\envs</span><span class="keyword">\scrap</span><span class="keyword">\python</span>.exe &quot;C:<span class="keyword">\bang</span><span class="keyword">\MyOwn</span><span class="keyword">\Java</span>重要知识点学习<span class="keyword">\BaiduSyncdisk</span><span class="keyword">\0</span>7 python网络爬虫<span class="keyword">\my</span><span class="built_in">_</span>code<span class="keyword">\ch</span>04-selenium<span class="keyword">\领</span>导留言板.py&quot; </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">body&#123; background:<span class="params">#</span>eff1f0; font-family: microsoft yahei; color:<span class="params">#9</span>69696; font-size:12px;&#125;</span><br><span class="line">.online-desc-con &#123; text-align:center; &#125;</span><br><span class="line">.r-tip01 &#123; color: <span class="params">#9</span>69696; font-size: 16px; display: block; text-align: center; width: 600px; padding: 0 10px; overflow: hidden; text-overflow: ellipsis; margin: 0 auto 15px; &#125;</span><br><span class="line">.r-tip02 &#123; color: <span class="params">#</span>b1b0b0; font-size: 12px; display: block; margin-top: 20px; margin-bottom: 20px; &#125;</span><br><span class="line">.r-tip02 a:visited &#123; text-decoration: underline; color: <span class="params">#0</span>088CC; &#125;</span><br><span class="line">.r-tip02 a:link &#123; text-decoration: underline; color: <span class="params">#0</span>088CC; &#125;</span><br><span class="line">img &#123; border: 0; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class=&quot;online-desc-con&quot; style=&quot;width:650px;padding-top:15px;margin:34px auto;&quot;&gt;</span><br><span class="line">    &lt;a id=&quot;official<span class="built_in">_</span>site&quot; href=&quot;http://www.365cyd.com&quot; target=&quot;<span class="built_in">_</span>blank&quot;&gt;</span><br><span class="line">        &lt;img id=&quot;wafblock&quot; alt=&quot;&quot; style=&quot;margin: 0 auto 17px auto;&quot; /&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">    &lt;span class=&quot;r-tip01&quot; id=&quot;error<span class="built_in">_</span>403&quot;&gt;&lt;/span&gt;</span><br><span class="line">    &lt;span class=&quot;r-tip01&quot; id=&quot;error<span class="built_in">_</span>403<span class="built_in">_</span>en&quot;&gt;&lt;/span&gt;</span><br><span class="line">    &lt;span class=&quot;r-tip02&quot;&gt;如果您是网站管理员&lt;a href=&quot;http://help.365cyd.com/cyd-error-help.html?code=403&quot; target=&quot;<span class="built_in">_</span>blank&quot;&gt;点击这里&lt;/a&gt;查看详情&lt;/span&gt;</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">    &lt;center&gt;client: &lt;span id=&quot;client<span class="built_in">_</span>ip&quot;&gt;&lt;/span&gt;, server: e85ed68, time: &lt;span id=&quot;time<span class="built_in">_</span>error&quot;&gt;&lt;/span&gt;&lt;span id=&quot;rule<span class="built_in">_</span>id&quot;&gt;&lt;/span&gt;&lt;/center&gt;</span><br><span class="line">    &lt;img alt=&quot;&quot; src=&quot;/cdn-cgi/image/logo.png&quot; /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    void(function fuckie6()&#123;if(location.hash <span class="built_in">&amp;</span><span class="built_in">&amp;</span> /MSIE 6/.test(navigator.userAgent) <span class="built_in">&amp;</span><span class="built_in">&amp;</span> !/jsl<span class="built_in">_</span>sec/.test(location.href))&#123;location.href = location.href.split(&#x27;<span class="params">#</span>&#x27;)[0] + &#x27;<span class="built_in">&amp;</span>jsl<span class="built_in">_</span>sec&#x27; + location.hash&#125;&#125;)();</span><br><span class="line">    var data = &#123;&quot;error<span class="built_in">_</span>403<span class="built_in">_</span>type&quot;:&quot;cli<span class="built_in">_</span>ip&quot;,&quot;error<span class="built_in">_</span>403&quot;:&quot;您的IP( 218.106.117.241 )最近有可疑的攻击行为，请稍后重试.&quot;,&quot;client<span class="built_in">_</span>ip&quot;:&quot;218.106.117.241&quot;,&quot;time<span class="built_in">_</span>error&quot;:&quot;16<span class="keyword">\/</span>May<span class="keyword">\/</span>2024:19:01:37 +0800&quot;,&quot;error<span class="built_in">_</span>403<span class="built_in">_</span>en&quot;:&quot;&quot;&#125;;</span><br><span class="line">    var rule<span class="built_in">_</span>id = parseInt(data[&#x27;rule<span class="built_in">_</span>id&#x27;]) || &#x27;&#x27;;</span><br><span class="line">    if (rule<span class="built_in">_</span>id != &#x27;&#x27;) &#123;</span><br><span class="line">        rule<span class="built_in">_</span>id = &#x27;[&#x27; + rule<span class="built_in">_</span>id + &#x27;]&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    document.getElementById(&quot;wafblock&quot;).src = &#x27;/cdn-cgi/image/&#x27; + (data[&#x27;error<span class="built_in">_</span>403<span class="built_in">_</span>type&#x27;] || &#x27;hacker&#x27;) + &#x27;.png&#x27;;</span><br><span class="line">    document.getElementById(&#x27;error<span class="built_in">_</span>403&#x27;).innerText = data[&#x27;error<span class="built_in">_</span>403&#x27;] || &#x27;当前访问疑似黑客攻击，已被创宇盾拦截。&#x27;;</span><br><span class="line">    document.getElementById(&#x27;error<span class="built_in">_</span>403<span class="built_in">_</span>en&#x27;).innerText = data[&#x27;error<span class="built_in">_</span>403<span class="built_in">_</span>en&#x27;];</span><br><span class="line">    document.getElementById(&#x27;client<span class="built_in">_</span>ip&#x27;).innerText = data[&#x27;client<span class="built_in">_</span>ip&#x27;];</span><br><span class="line">    document.getElementById(&#x27;time<span class="built_in">_</span>error&#x27;).innerText = data[&#x27;time<span class="built_in">_</span>error&#x27;];</span><br><span class="line">    document.getElementById(&#x27;rule<span class="built_in">_</span>id&#x27;).innerText = rule<span class="built_in">_</span>id;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="使用Selenium的一般流程"><a href="#使用Selenium的一般流程" class="headerlink" title="使用Selenium的一般流程"></a>使用Selenium的一般流程</h3><ol>
<li>selenium打开浏览器</li>
<li>访问要爬取的页面，如果有需要可以设置对页面进行一些操作</li>
<li>获取想要爬取的页面数据</li>
</ol>
<h3 id="selenium环境安装"><a href="#selenium环境安装" class="headerlink" title="selenium环境安装"></a>selenium环境安装</h3><p><strong>selenium安装</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install selenium</span><br></pre></td></tr></table></figure>
<p><strong>浏览器对应的驱动chromedriver的下载</strong></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/664339667">chromeDriver下载参考资料</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/linglong_L/article/details/136283810?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1-136283810-blog-138708545.235^v43^pc_blog_bottom_relevance_base6&amp;spm=1001.2101.3001.4242.2&amp;utm_relevant_index=2">chromeDriver参考资料</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/aiyablog/articles/17948703">ChromeDriver下载地址列表</a></p>
<p>安装之后可以在代码中指定charomeDriver的地址或者我们可以直接将chromeDriver放在python的安装文件夹中，更推荐后者</p>
<p>测试是否安装成功:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;https://www.baidu.com&quot;</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"><span class="comment">#请求</span></span><br><span class="line">driver.get(url)</span><br><span class="line"><span class="comment">#短暂延时</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#获取页面内容</span></span><br><span class="line">html = driver.page_source</span><br><span class="line"><span class="built_in">print</span>(html)</span><br><span class="line"><span class="comment">#关闭</span></span><br><span class="line">driver.quit()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>会自动弹出百度首页</p>
<h3 id="selenium基本用法"><a href="#selenium基本用法" class="headerlink" title="selenium基本用法"></a>selenium基本用法</h3><p><a target="_blank" rel="noopener" href="https://selenium-python-zh.readthedocs.io/en/latest/installation.html">Python selenium库官方文档</a></p>
<p><strong>启动浏览器</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">driver = webdriver.Chrome()</span><br></pre></td></tr></table></figure>
<p><strong>访问页面</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.get(url)</span><br></pre></td></tr></table></figure>
<p><strong>窗口最大化</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.maximize_window()</span><br></pre></td></tr></table></figure>
<p><strong>刷新页面</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.refresh()</span><br></pre></td></tr></table></figure>
<p><strong>获取页面源码</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html = driver.page_source</span><br></pre></td></tr></table></figure>
<p><strong>页面截图</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.save_screenshot(<span class="string">&quot;xxx.png&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>关闭浏览器</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<p>使用Selenium时，如果关闭的时候没有使用driver.quit退出，会导致系统中会启动多个chromeDriver程序，可以在命令行中通过如下命令批量删除chromedriver进程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taskkill /F /im chromedriver.exe</span><br></pre></td></tr></table></figure>
<h3 id="Selenium-driver对象的相关属性"><a href="#Selenium-driver对象的相关属性" class="headerlink" title="Selenium driver对象的相关属性"></a>Selenium driver对象的相关属性</h3><ul>
<li>current_url：当前url地址</li>
<li>title：页面标题</li>
<li>page_source：页面html源码，注意这个页面源码与requests获取的源码是不一样的，其是所有js执行之后的完整的源码</li>
<li>window_handler:获取浏览器上所有窗口句柄，窗口句柄即各个窗口id</li>
<li>curren_window_handler：获取当前窗口的句柄</li>
</ul>
<h3 id="selenium元素定位和等待"><a href="#selenium元素定位和等待" class="headerlink" title="selenium元素定位和等待"></a>selenium元素定位和等待</h3><h4 id="元素定位的方法："><a href="#元素定位的方法：" class="headerlink" title="元素定位的方法："></a>元素定位的方法：</h4><p><a target="_blank" rel="noopener" href="https://selenium-python-zh.readthedocs.io/en/latest/locating-elements.html">selenium查找元素官网教程</a></p>
<p>一般我们知道如何通过xpath来定位元素就够了</p>
<p><strong>案例：打开百度首页，在输入框中输入值进行搜索</strong></p>
<p>首先打开百度首页，定位带搜索输入框元素，向输入框中输入值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="comment">#打开浏览器</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"><span class="comment">#url</span></span><br><span class="line">url = <span class="string">&quot;https://www.baidu.com&quot;</span></span><br><span class="line"><span class="comment">#发送请求</span></span><br><span class="line">driver.get(url)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"><span class="comment">#定位到搜索框</span></span><br><span class="line">element = driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;kw&quot;]&#x27;</span>)</span><br><span class="line"><span class="comment">#输入内容，发送请求</span></span><br><span class="line">element.send_keys(<span class="string">&quot;三国演义&quot;</span>)</span><br><span class="line"><span class="comment">#关闭浏览器</span></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516202419933.png" alt="image-20240516202419933" style="zoom:67%;"></p>
<h4 id="元素的属性和操作"><a href="#元素的属性和操作" class="headerlink" title="元素的属性和操作"></a>元素的属性和操作</h4><h5 id="元素属性"><a href="#元素属性" class="headerlink" title="元素属性"></a>元素属性</h5><ul>
<li>tagname：获取标签名</li>
<li>text：获取标签文本</li>
<li>parent：获取父级标签</li>
<li>get_attribute()：获取属性</li>
<li>s_displayed()：判断元素是否可见</li>
</ul>
<h5 id="元素的操作"><a href="#元素的操作" class="headerlink" title="元素的操作"></a>元素的操作</h5><ul>
<li>click()，点击元素</li>
<li>send_keys()：输入内容</li>
<li>clear()：清空表单</li>
</ul>
<h3 id="selenium模拟登录案例"><a href="#selenium模拟登录案例" class="headerlink" title="selenium模拟登录案例"></a>selenium模拟登录案例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">需求分析:</span></span><br><span class="line"><span class="string">    selenium模拟登录中华网:https://passport.china.com/logon</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">params=&#123;</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;17775990925&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;a546245426&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#打开浏览器</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"><span class="comment">#发送请求</span></span><br><span class="line">url = <span class="string">&quot;https://passport.china.com/logon&quot;</span></span><br><span class="line">driver.get(url)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"></span><br><span class="line"><span class="comment">#定位登录的表单元素</span></span><br><span class="line"><span class="comment">#用户名元素</span></span><br><span class="line">userNameElement = driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;userInput&quot;]/input[@name=&quot;userName&quot;]&#x27;</span>)</span><br><span class="line"><span class="comment">#密码元素</span></span><br><span class="line">passWordElement = driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;55&quot;]&#x27;</span>)</span><br><span class="line"><span class="comment">#登录按钮</span></span><br><span class="line">loginButtonElement = driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;index_logonid&quot;]&#x27;</span>)</span><br><span class="line"><span class="comment">#填入信息</span></span><br><span class="line">userNameElement.send_keys(params[<span class="string">&quot;userName&quot;</span>])</span><br><span class="line">passWordElement.send_keys(params[<span class="string">&quot;password&quot;</span>])</span><br><span class="line"><span class="comment">#点击登录按钮</span></span><br><span class="line">loginButtonElement.click()</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭浏览器</span></span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<h3 id="selenium爬取数据案例"><a href="#selenium爬取数据案例" class="headerlink" title="selenium爬取数据案例"></a>selenium爬取数据案例</h3><p><strong>需求分析</strong></p>
<p>利用selenium爬取领导留言板数据</p>
<p>主要抓取各个留言的：</p>
<ul>
<li>标题</li>
<li>正文内容</li>
<li>时间</li>
<li>留言ID</li>
</ul>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516205322272.png" alt="image-20240516205322272" style="zoom:67%;"></p>
<p><strong>代码示例</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">selenium访问指定页面，并对页面解析，获取对应数据</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> selector</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;https://liuyan.people.com.cn/threads/list?checkStatus=0&amp;fid=571&amp;formName=%E6%B9%96%E5%8C%97%E7%9C%81%E5%A7%94%E4%B9%A6%E8%AE%B0%E7%8E%8B%E8%92%99%E5%BE%BD&amp;position=0&amp;province=28&amp;city=&amp;saveLocation=28&amp;pForumNames=%E6%B9%96%E5%8C%97%E7%9C%81&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#打开浏览器</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"><span class="comment">#访问页面</span></span><br><span class="line">driver.get(url)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"><span class="comment">#等待</span></span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"><span class="comment">#利用selenium定位元素</span></span><br><span class="line">titleElementList = driver.find_elements(By.XPATH,<span class="string">&#x27;//h1&#x27;</span>)</span><br><span class="line">textElementList = driver.find_elements(By.XPATH,<span class="string">&#x27;//p/span&#x27;</span>)</span><br><span class="line">timeElementList = driver.find_elements(By.XPATH,<span class="string">&#x27;//div[@class=&quot;headMainS fl&quot;]/p&#x27;</span>)</span><br><span class="line">IdElementList = driver.find_elements(By.XPATH,<span class="string">&#x27;//span[contains(text(),&quot;留言ID&quot;)]&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> titleElement,timeElement,IdElement,textElemen <span class="keyword">in</span> <span class="built_in">zip</span>(titleElementList,timeElementList,IdElementList,textElementList):</span><br><span class="line">    <span class="built_in">print</span>(timeElement.text,<span class="string">&quot;\t&quot;</span>,titleElement.text,<span class="string">&quot;\t&quot;</span>,IdElement.text)</span><br><span class="line">    <span class="built_in">print</span>(textElemen.text)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">20</span>)</span><br><span class="line"><span class="comment">#获取页面加载后的源码</span></span><br><span class="line"><span class="comment"># html = driver.page_source</span></span><br><span class="line"><span class="comment"># print(html)</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">页面元素分析，如何利用xpath进行解析:</span></span><br><span class="line"><span class="string">标题: //h1/text()</span></span><br><span class="line"><span class="string">正文: //p/span/text()</span></span><br><span class="line"><span class="string">时间: //div[@class=&quot;headMainS fl&quot;]/p/text()</span></span><br><span class="line"><span class="string">留言ID://span[contains(text(),&quot;留言ID&quot;)]/text()</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭浏览器</span></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">driver.quit()</span><br><span class="line"></span><br><span class="line"><span class="comment">#解析</span></span><br><span class="line"><span class="comment"># title_list = selector.Selector(text=html).xpath(&quot;//h1/text()&quot;).extract()</span></span><br><span class="line"><span class="comment"># time_list = selector.Selector(text=html).xpath(&#x27;//div[@class=&quot;headMainS fl&quot;]/p/text()&#x27;).extract()</span></span><br><span class="line"><span class="comment"># ID_list = selector.Selector(text=html).xpath(&#x27;//span[contains(text(),&quot;留言ID&quot;)]/text()&#x27;).extract()</span></span><br><span class="line"><span class="comment"># for title,time,ID in zip(title_list,time_list,ID_list):</span></span><br><span class="line"><span class="comment">#     print(title+&quot;\t&quot;+time+&quot;\t&quot;+ID)</span></span><br></pre></td></tr></table></figure>
<p><strong>目前存在的问题</strong></p>
<ul>
<li><p>正文内容抓取不全，如下图所示，每一条帖子需要点击<strong>查看全文</strong>才能显示完全</p>
<ul>
<li><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516212857275.png" alt="image-20240516212857275"></li>
</ul>
</li>
<li><p>内容抓取不全，目前只能抓取第一页数据，需要手动点击<strong>查看更多</strong>才能获取下一页记录</p>
<ul>
<li><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240516212942046.png" alt="image-20240516212942046"></li>
</ul>
</li>
</ul>
<h2 id="selenium进阶使用"><a href="#selenium进阶使用" class="headerlink" title="selenium进阶使用"></a>selenium进阶使用</h2><h3 id="等待机制"><a href="#等待机制" class="headerlink" title="等待机制"></a>等待机制</h3><p><a target="_blank" rel="noopener" href="https://selenium-python-zh.readthedocs.io/en/latest/waits.html">官网 等待页面加载完成文档</a></p>
<h4 id="背景-1"><a href="#背景-1" class="headerlink" title="背景"></a><strong>背景</strong></h4><p>现在大多数网页都是动态加载的，如果页面内容发生变更，就需要时间来进行渲染，代码是自动执行的，有可能在执行的时候页面新的元素还没有加载出来，就查不到，报 no such element的错误，如果报这个错误，则有可能是定位表达式不正确，或者也可能是页面元素已经发生了变化</p>
<p>我们爬虫的过程中，如果打开新的页面、页面跳转等情况都要添加合适的等待，否则有的情况下会导致程序错误，无法进行下去</p>
<h4 id="等待的三种方式"><a href="#等待的三种方式" class="headerlink" title="等待的三种方式"></a><strong>等待的三种方式</strong></h4><ul>
<li>强制等待<ul>
<li><code>time.sleep(n)</code></li>
</ul>
</li>
<li>隐式等待<ul>
<li><code>driver.implicitly_wait(n)</code></li>
</ul>
</li>
<li>显示等待（需要等待条件满足）<ul>
<li>隐式等待某些情况找不到，就要用显示等待</li>
</ul>
</li>
</ul>
<h4 id="强制等待"><a href="#强制等待" class="headerlink" title="强制等待"></a>强制等待</h4><p><code>time.sleep()</code></p>
<p>不管网页有没有加载完成，都会等待指定时间</p>
<h4 id="隐式等待"><a href="#隐式等待" class="headerlink" title="隐式等待"></a>隐式等待</h4><p><code>driver.implicitly_wait(n)</code></p>
<p>如果某些元素不是立即可用的，隐式等待是告诉WebDriver去等待一定的时间后去查找元素。 默认等待时间是0秒</p>
<p>在n秒内如果还是找不到，则会抛出异常，在指定时间内，每隔一段时间就去看一下，如果成功找到，则程序会继续往下执行，如果没找到则继续等，直到最大等待时间</p>
<h4 id="显示等待"><a href="#显示等待" class="headerlink" title="显示等待"></a>显示等待</h4><p>可以设置等待条件，比如等待到某个元素可见、某个元素可点击</p>
<p>这种情况比较复杂，我们重点关注这种情况下如何使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line"><span class="comment">#第一步:创建等待对象</span></span><br><span class="line">wait = WebDriverWait(driver, <span class="number">10</span>)  <span class="comment">#WebDriverWait 三个参数，第一个为driver对象，第二个为最大时间，第三个为间隔时间，比如:WebDriverWait(driver,30,0.2)，即在30s内每个0.2s去找一次</span></span><br><span class="line"><span class="comment">#第二步：定义元素查找对象</span></span><br><span class="line">located = (By.XPATH,<span class="string">&quot;//input[@id=&#x27;u&#x27;&quot;</span>)</span><br><span class="line"><span class="comment">#第三步：定位的等待条件,比如指定元素可见为等待条件</span></span><br><span class="line">conditions = EC.visibility_of_element_located(located)</span><br><span class="line"><span class="comment">#第四步:通过等待计时器对象去查找</span></span><br><span class="line">wait.until(conditions)</span><br><span class="line"></span><br><span class="line"><span class="comment">#一行代码表示</span></span><br><span class="line">WebDriverWait(driver, <span class="number">10</span>)</span><br><span class="line">            .until(EC.visibility_of_element_located((By.XPATH,<span class="string">&quot;//input[@id=&#x27;u&#x27;&quot;</span>)))</span><br></pre></td></tr></table></figure>
<h5 id="常用显示等待条件"><a href="#常用显示等待条件" class="headerlink" title="常用显示等待条件"></a><strong>常用显示等待条件</strong></h5><ul>
<li><code>visibility_of_element_located</code>：元素可见</li>
<li><code>element_to_be_clickable</code>：元素可点击</li>
</ul>
<h5 id="等待条件"><a href="#等待条件" class="headerlink" title="等待条件"></a>等待条件</h5><ul>
<li><code>presence_of_element_located</code>：元素存在</li>
<li><code>visibility_of_element_located</code>：元素可见</li>
<li><code>element_to_be_clickable</code>：元素可点击</li>
<li><code>title_contains</code>：标题包含某内容</li>
<li><code>new_window_is_opened</code>：等待新窗口出现</li>
<li><code>frame_to_be_available_and_switch_to_it</code>：加载并切换到iframe中</li>
<li><code>alert_is_present</code>：出现Alert弹框</li>
</ul>
<h3 id="iframe切换"><a href="#iframe切换" class="headerlink" title="iframe切换"></a>iframe切换</h3><h4 id="背景-2"><a href="#背景-2" class="headerlink" title="背景"></a>背景</h4><p>对于<a target="_blank" rel="noopener" href="https://wx.mail.qq.com/">QQ邮箱登录页面</a>，其内部是一个网页嵌套另一个网页构成的，如果直接查找或者点击里面的某些元素是找不到的，必须要进行iframe切换</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240517091621440.png" alt="image-20240517091621440"></p>
<h4 id="selenium控制iframe切换"><a href="#selenium控制iframe切换" class="headerlink" title="selenium控制iframe切换"></a>selenium控制iframe切换</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方式一：切换iframe，通过iframe的名字(name属性)进行切换</span></span><br><span class="line">driver.switch_to.frame(<span class="string">&#x27;frame_name&#x27;</span>) </span><br><span class="line"><span class="comment">#方式二:通过element元素去切换</span></span><br><span class="line">iframeElement = driver.find_element_by_xpath(<span class="string">&#x27;//iframe[@id=&quot;login_frame&quot;]&#x27;</span>)</span><br><span class="line">driver.switch_to.frame(iframeElement)</span><br><span class="line"><span class="comment">#方式三：通过索引切换</span></span><br><span class="line">driver.switch_to.frame(<span class="number">1</span>) <span class="comment">#根据第几个iframe切换</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#切换回默认的html页面</span></span><br><span class="line">driver.switch_to.default_content()</span><br><span class="line"></span><br><span class="line"><span class="comment">#切换到父级的iframe中</span></span><br><span class="line">driver.switch_to.parent_frame()</span><br></pre></td></tr></table></figure>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p>模拟QQ邮箱登录页面点击密码登录，然后输入账号密码模拟登陆</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240517092226636.png" alt="image-20240517092226636"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"><span class="comment">#url</span></span><br><span class="line">url = <span class="string">&quot;https://wx.mail.qq.com/&quot;</span></span><br><span class="line">driver.get(url=url)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"></span><br><span class="line"><span class="comment">#切换进入第一个iframe</span></span><br><span class="line">driver.switch_to.frame(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#切换进入第二个iframe</span></span><br><span class="line">iframeElement = driver.find_element(By.XPATH,<span class="string">&#x27;//iframe[@id=&quot;ptlogin_iframe&quot;]&#x27;</span>)</span><br><span class="line">driver.switch_to.frame(iframeElement)</span><br><span class="line"></span><br><span class="line"><span class="comment">#查找密码登录按钮，并点击</span></span><br><span class="line">passwordLoginButton = driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;switcher_plogin&quot;]&#x27;</span>)</span><br><span class="line">passwordLoginButton.click()</span><br><span class="line"></span><br><span class="line"><span class="comment">#找到账号和密码输入框，模拟登录</span></span><br><span class="line">driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;u&quot;]&#x27;</span>).send_keys(<span class="string">&quot;wujjjj&quot;</span>)</span><br><span class="line">driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;p&quot;]&#x27;</span>).send_keys(<span class="string">&quot;99899&quot;</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#登录按钮</span></span><br><span class="line">driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;login_button&quot;]&#x27;</span>).click()</span><br><span class="line"><span class="comment">#关闭浏览器</span></span><br><span class="line">time.sleep(<span class="number">10</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<p><strong>执行结果</strong></p>
<p>最终还会弹出</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240517094617205.png" alt="image-20240517094617205"></p>
<h3 id="窗口滚动"><a href="#窗口滚动" class="headerlink" title="窗口滚动"></a>窗口滚动</h3><h4 id="背景-3"><a href="#背景-3" class="headerlink" title="背景"></a>背景</h4><p>有的时候，元素虽然被加载出来了，但是如果看不到，是无法进行操作的，这时就需要滚动页面才会显示新的内容</p>
<p>比如对于我们之前爬取的<a target="_blank" rel="noopener" href="https://liuyan.people.com.cn/threads/list?checkStatus=0&amp;fid=571&amp;formName=%E6%B9%96%E5%8C%97%E7%9C%81%E5%A7%94%E4%B9%A6%E8%AE%B0%E7%8E%8B%E8%92%99%E5%BE%BD&amp;position=0&amp;province=28&amp;city=&amp;saveLocation=28&amp;pForumNames=%E6%B9%96%E5%8C%97%E7%9C%81">领导留言板</a>网站，就需要手动滚动页面到最底部，然后点击查看更多，才能分页查看下一页数据</p>
<p>所以要想抓取数据完全，需要不断查找查看更多按钮，然后点击进行翻页</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240517111858981.png" alt="image-20240517111858981"></p>
<h4 id="代码示例-1"><a href="#代码示例-1" class="headerlink" title="代码示例"></a>代码示例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://liuyan.people.com.cn/threads/list?checkStatus=0&amp;fid=1179&amp;formName=%E5%AE%9C%E6%98%8C%E5%B8%82%E5%A7%94%E4%B9%A6%E8%AE%B0%E7%86%8A%E5%BE%81%E5%AE%87&amp;position=0&amp;province=28&amp;city=230&amp;saveLocation=28&amp;pForumNames=%E6%B9%96%E5%8C%97%E7%9C%81&amp;pForumNames=%E5%AE%9C%E6%98%8C%E5%B8%82&quot;</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"><span class="comment">#隐式等待</span></span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">driver.get(url)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:  <span class="comment">#循环迭代 找到查看更多，并翻页,无法确定有多少也，只能死循环，找不到即触发异常结束</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 找到 查看更多按钮</span></span><br><span class="line">        element = driver.find_element(By.XPATH, <span class="string">&#x27;//*[@class=&quot;mordList&quot;]&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(element)</span><br><span class="line">        time.sleep(random.randint(<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line">        element.location_once_scrolled_into_view  <span class="comment"># 页面滚动到 查看更多按钮可见的位置</span></span><br><span class="line">        <span class="comment"># 点击查看更多按钮</span></span><br><span class="line">        time.sleep(random.randint(<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line">        element.click()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment">#整体页面解析</span></span><br><span class="line"><span class="comment">#利用selenium定位元素</span></span><br><span class="line">titleElementList = driver.find_elements(By.XPATH,<span class="string">&#x27;//h1&#x27;</span>)</span><br><span class="line">textElementList = driver.find_elements(By.XPATH,<span class="string">&#x27;//p/span&#x27;</span>)</span><br><span class="line">timeElementList = driver.find_elements(By.XPATH,<span class="string">&#x27;//div[@class=&quot;headMainS fl&quot;]/p&#x27;</span>)</span><br><span class="line">IdElementList = driver.find_elements(By.XPATH,<span class="string">&#x27;//span[contains(text(),&quot;留言ID&quot;)]&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> titleElement,timeElement,IdElement,textElemen <span class="keyword">in</span> <span class="built_in">zip</span>(titleElementList,timeElementList,IdElementList,textElementList):</span><br><span class="line">    <span class="built_in">print</span>(timeElement.text,<span class="string">&quot;\t&quot;</span>,titleElement.text,<span class="string">&quot;\t&quot;</span>,IdElement.text)</span><br><span class="line">    <span class="built_in">print</span>(textElemen.text)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;总条数:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(titleElementList)))</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<h3 id="JS模拟滚动页面"><a href="#JS模拟滚动页面" class="headerlink" title="JS模拟滚动页面"></a>JS模拟滚动页面</h3><p><strong>js滚动窗口到指定坐标位置</strong></p>
<ul>
<li><p><code>scrollTo()</code>：可把内容滚动到指定的坐标</p>
<ul>
<li>```js<br>scrollTo(x,y)<h1 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h1>x ：必须，要在窗口文档显示区左上角显示的文档的x坐标<br>y : 必须，要在窗口文档显示区左上角显示的文档的y坐标<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**selenium如何执行js代码**</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">#移动Y坐标到500的位置</span><br><span class="line">js = &quot;window.scrollTo(0,500)&quot;</span><br><span class="line">driver.execute_script(js)</span><br><span class="line"></span><br><span class="line">#滚动到窗口底板</span><br><span class="line">js = &quot;window.scrollTo(0,document.body.scrollHeight)&quot;</span><br><span class="line">driver.execute_script(js)</span><br><span class="line"></span><br><span class="line">#相对滚动</span><br><span class="line">#scrollBy(x1,x2)表示相对当前位置(x,y)，页面下一步滚动到 x+x1,y+y1</span><br><span class="line">#有的时候，突然滚动到底部，可能会被反爬机制识别，这是用相对滑动，模拟人的操作</span><br><span class="line">js = &quot;window.scrollBy(0,100)&quot;</span><br><span class="line">driver.execute_script(js)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="鼠标操作"><a href="#鼠标操作" class="headerlink" title="鼠标操作"></a>鼠标操作</h3><p>比如：有的页面需要模拟鼠标操作，对页面元素进行拖拽操作，比如滑块验证码之类的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br></pre></td></tr></table></figure>
<p>ActionChains：鼠标操作类</p>
<ul>
<li>click：鼠标点击</li>
<li>double_click：鼠标双击</li>
<li>context_click：鼠标右击</li>
<li>move_to_element：鼠标移动到某个节点</li>
<li>click_and_hold：鼠标左键按下鼠标</li>
<li>move_by_offse：鼠标相对当前位置进行移动</li>
<li>drag_and_drop()：在一个位置按下鼠标，到另一个位置进行释放</li>
<li>release：释放鼠标</li>
<li>perform：执行动作</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/try/try.php?filename=jqueryui-api-droppable">鼠标操作练习网站</a></p>
<p><strong>实例代码</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ActionChains：鼠标操作类</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- click：鼠标点击</span></span><br><span class="line"><span class="string">- double_click：鼠标双击</span></span><br><span class="line"><span class="string">- context_click：鼠标右击</span></span><br><span class="line"><span class="string">- move_to_element：鼠标移动到某个节点</span></span><br><span class="line"><span class="string">- click_and_hold：鼠标左键按下鼠标</span></span><br><span class="line"><span class="string">- move_by_offse：鼠标相对当前位置进行移动</span></span><br><span class="line"><span class="string">- drag_and_drop()：在一个位置按下鼠标，到另一个位置进行释放</span></span><br><span class="line"><span class="string">- release：释放鼠标</span></span><br><span class="line"><span class="string">- perform：执行动作</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">driver.get(<span class="string">&#x27;https://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&#x27;</span>)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"></span><br><span class="line"><span class="comment">#切换到子iframe</span></span><br><span class="line">driver.switch_to.frame(driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;iframeResult&quot;]&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#找到拖拽块元素</span></span><br><span class="line">dragElement = driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;draggable&quot;]&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#实例化 ActionChains对象</span></span><br><span class="line">ac = ActionChains(driver)</span><br><span class="line"><span class="comment">#将鼠标移动到该元素上</span></span><br><span class="line">ac.move_to_element(dragElement)</span><br><span class="line"><span class="comment">#按住鼠标不放</span></span><br><span class="line">ac.click_and_hold()</span><br><span class="line"><span class="comment">#将鼠标移动到另一个元素</span></span><br><span class="line">ac.move_to_element(driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;droppable&quot;]&#x27;</span>))</span><br><span class="line"><span class="comment">#执行鼠标动作</span></span><br><span class="line">ac.perform()</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭浏览器</span></span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<p><strong>执行结果</strong></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240517184401515.png" alt="image-20240517184401515"></p>
<h3 id="selenium携带cookie登录"><a href="#selenium携带cookie登录" class="headerlink" title="selenium携带cookie登录"></a>selenium携带cookie登录</h3><p>很多网站需要登录才能访问其他页面，这种情况我们需要首先需要利用selenium模拟登录获取网站的cookie信息，然后在访问其他网站的时候模拟</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43821172/article/details/105199481">参考资料</a></p>
<h2 id="selenium特征检测"><a href="#selenium特征检测" class="headerlink" title="selenium特征检测"></a>selenium特征检测</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/321928394">参考资料 js文件下载地址</a></p>
<h3 id="selenium启动的浏览器可能具有以下特殊的特征"><a href="#selenium启动的浏览器可能具有以下特殊的特征" class="headerlink" title="selenium启动的浏览器可能具有以下特殊的特征"></a>selenium启动的浏览器可能具有以下特殊的特征</h3><ul>
<li>User-Agent字符串<ul>
<li>Selenium启动的浏览器通常具有特定的User-Agent字符串，可以通过检查User-Agent来判断是否为Selenium启动的浏览器</li>
</ul>
</li>
<li>自动化工具标识<ul>
<li>Selenium启动的浏览器可能会在请求头中包含一些自动化工具的标识，例如<code>Requested-With</code>、<code>DNT</code>等</li>
</ul>
</li>
<li>WebDriver相关属性<ul>
<li>Selenium启动的浏览器可能会在全局<code>window</code>对象中注入一些特殊的属性，例如<code>webdriver</code>、<code>navigator.webdriver</code>等</li>
</ul>
</li>
<li>页面加载行为<ul>
<li>Selenium启动的浏览器通常会以自动化的方式加载页面，可能会出现一些快速点击、输入文本等行为</li>
</ul>
</li>
<li>元素检测<ul>
<li>Selenium启动浏览器的时候会在DOM中插入一些特定的元素或者属性，用于控制浏览器行为，可以通过检测这些特定的元素或属性来判断是否为Selenium启动的浏览器</li>
</ul>
</li>
</ul>
<h3 id="如果想使用selenium正常访问，则需要在创建webdriver时隐藏浏览器相关的特征"><a href="#如果想使用selenium正常访问，则需要在创建webdriver时隐藏浏览器相关的特征" class="headerlink" title="如果想使用selenium正常访问，则需要在创建webdriver时隐藏浏览器相关的特征"></a>如果想使用selenium正常访问，则需要在创建webdriver时隐藏浏览器相关的特征</h3><ul>
<li><code>--disable-infobars</code>：禁止显示Chrome浏览器正在受到自动测试软件控制的通知栏</li>
<li><code>excludeSwitches</code>、<code>enable-automation</code>：排除启动自动化扩展程序的开关，可以防止被网站检测到使用了自动化测试工具，减少被反爬虫封锁的可能</li>
<li><code>useAutomationExtension:False</code>：禁用自动化扩展程序，同样为了避免被网站检测到使用了自动化工具</li>
<li>通过<code>Page.addScriptToEvaluateOnNewDocument</code>方法，可以在每次页面加载时执行指定的JavaScript代码，我们每次打开新页面之前，执行<code>hide.js</code>来隐藏selenium启动浏览器生成的属性，从而防止被检测出来时爬虫</li>
</ul>
<h3 id="绕过特征检测案例"><a href="#绕过特征检测案例" class="headerlink" title="绕过特征检测案例"></a>绕过特征检测案例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">目标网站: https://www.aqistudy.cn/ 对selenium做了反爬</span></span><br><span class="line"><span class="string">如果用selenium打开，是不会有数据显示的</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置浏览器配置,隐藏selenium一些特性</span></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line"><span class="comment">#添加防检测的参数</span></span><br><span class="line">options.add_argument(<span class="string">&quot;--disable-infobars&quot;</span>)</span><br><span class="line">options.add_experimental_option(<span class="string">&quot;excludeSwitches&quot;</span>,[<span class="string">&quot;enable-automation&quot;</span>])</span><br><span class="line">options.add_experimental_option(<span class="string">&quot;useAutomationExtension&quot;</span>,<span class="literal">False</span>)</span><br><span class="line"><span class="comment">#添加浏览器头</span></span><br><span class="line">options.add_argument(<span class="string">&#x27;user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36&#x27;</span>)</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(options=options)</span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#每次打开新的页面之前，执行该脚本，去除selenium打开浏览器生成的相关属性特征</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;../stealth.min.js&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    js = f.read()</span><br><span class="line">driver.execute_cdp_cmd(<span class="string">&quot;Page.addScriptToEvaluateOnNewDocument&quot;</span>,&#123;</span><br><span class="line">    <span class="string">&quot;source&quot;</span>: js</span><br><span class="line">&#125;)</span><br><span class="line">url = <span class="string">&#x27;https://www.aqistudy.cn/&#x27;</span></span><br><span class="line">driver.get(url)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭</span></span><br><span class="line">time.sleep(<span class="number">20</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<h2 id="JS逆向分析"><a href="#JS逆向分析" class="headerlink" title="JS逆向分析"></a>JS逆向分析</h2><h3 id="js参数加密案例"><a href="#js参数加密案例" class="headerlink" title="js参数加密案例"></a>js参数加密案例</h3><p>许多网站的请求参数都是加密传递的，要模拟发送请求，就得直到参数是怎么加密的，然后用代码实现加密的过程</p>
<p>比如对于一些网站的登录页面，其账号、密码传输时是通过某种加密算法加密后再发送请求的</p>
<h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><p>对于 <a target="_blank" rel="noopener" href="https://www.94mxd.com.cn/signin">网站</a>的登录界面，</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240517194933379.png" alt="image-20240517194933379"></p>
<p>我们输入账号、密码模拟登录，抓包分析，发现其密码是加密后的数据</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240517195033515.png" alt="image-20240517195033515"></p>
<p>找到调用的js文件</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240517202540845.png" alt="image-20240517202540845"></p>
<p>我们班通过打断点分析，定位带其js代码中加密的函数,实际上是一个 盐值拼接，然后采用md5加密得到</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240517202750673.png" alt="image-20240517202750673"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240517202817522.png" alt="image-20240517202817522"></p>
<h4 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="comment">#md5加密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hashPwd</span>(<span class="params">password</span>):</span><br><span class="line">    <span class="comment">#盐值</span></span><br><span class="line">    saltValue = <span class="string">&quot;Hq44cyp4mT9Fh5eNrZ67bjifidFhW%fb0ICjx#6gE59@P@Hr8%!WuYBa1yvytq$qh1FEM18qA8Hp9m3VLux9luIYpeYzA2l2W3Z&quot;</span></span><br><span class="line">    <span class="comment">#加密</span></span><br><span class="line">    strVal = password+saltValue</span><br><span class="line"></span><br><span class="line">    hashObj = hashlib.md5()</span><br><span class="line">    hashObj.update(strVal.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    md5StrVal = hashObj.hexdigest()</span><br><span class="line">    <span class="keyword">return</span> md5StrVal</span><br></pre></td></tr></table></figure>
<p>当然，如果我们采用selenium模拟登录，无需直到其加密算法，直接在输入框中输入明文，即可模拟登录</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.94mxd.com.cn/signin&quot;</span></span><br><span class="line">params=&#123;</span><br><span class="line">    <span class="string">&quot;email&quot;</span>: <span class="string">&quot;1985439923@qq.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;wu123456&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#模拟登录</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(url)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"></span><br><span class="line"><span class="comment">#定位元素输入值</span></span><br><span class="line">driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;email&quot;]&#x27;</span>).send_keys(params[<span class="string">&quot;email&quot;</span>])</span><br><span class="line">driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;password&quot;]&#x27;</span>).send_keys(params[<span class="string">&quot;password&quot;</span>])</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#点击登录按钮</span></span><br><span class="line">driver.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;container&quot;]/div/div/div[2]/div[2]//button&#x27;</span>).click()</span><br><span class="line"><span class="comment">#关闭浏览器</span></span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>
<h3 id="调用js加密代码"><a href="#调用js加密代码" class="headerlink" title="调用js加密代码"></a>调用js加密代码</h3><p>在逆向分析时，有时候会发现某个js加密算法会比较繁琐，用python还原同样的算法会比较费劲，此时，我们可以不必使用python去还原，而是利用python去直接调用JavaScript中定义的功能，通过调式分析加密算法所在的位置和源码，然后直接在代码中调用该js代码</p>
<p>python调用js，需要借助于第三方库<code>pyexcejs</code>，这个库底层调用<code>node.js</code>，所以还需要安装<code>node.js</code></p>
<p><strong>代码示例</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">python调用js用第三方库:</span></span><br><span class="line"><span class="string">    需要安装python第三方库:pyexecjs</span></span><br><span class="line"><span class="string">    需要安装: node.js</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line">jsCode=<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">function add(a,b)&#123;</span></span><br><span class="line"><span class="string">    return a+b</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function say()&#123;</span></span><br><span class="line"><span class="string">    return &quot;say,hello!!!&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#第一步：编译代码</span></span><br><span class="line">JS = execjs.<span class="built_in">compile</span>(jsCode)</span><br><span class="line"><span class="comment">#第二部调用</span></span><br><span class="line">result = JS.call(<span class="string">&quot;add&quot;</span>,<span class="number">100</span>,<span class="number">200</span>)</span><br><span class="line">message = JS.call(<span class="string">&quot;say&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="built_in">print</span>(message)</span><br></pre></td></tr></table></figure>
<h2 id="验证码破解"><a href="#验证码破解" class="headerlink" title="验证码破解"></a>验证码破解</h2><h3 id="图像验证码破解"><a href="#图像验证码破解" class="headerlink" title="图像验证码破解"></a>图像验证码破解</h3><p>许多网站，在登陆的时候，除了输入账号、密码之外，还会显示一个图像验证码，那么这类网站应该如何破解？</p>
<p>对于 <a target="_blank" rel="noopener" href="https://www.chaojiying.com/user/login/">超级鹰</a>：网站登陆页面，如下图所示：其会显示一个图像验证码，要想破解这类网站，就需要能够识别图像验证码中的字符</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518200110879.png" alt="image-20240518200110879" style="zoom: 33%;"></p>
<p>抓包分析，一打开登陆界面，其会自动向后台发送一个请求，获取一个图像验证码，且该同一链接地址多次请求，返回的结果均是不同的</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518200524218.png" alt="image-20240518200524218" style="zoom:33%;"></p>
<p>对于其点击登陆按钮发送的登陆请求，抓包如下图所示：</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518200840384.png" alt="image-20240518200840384" style="zoom:50%;"></p>
<p>综上所述，该问题的难点就在于验证码的识别问题</p>
<p><strong>破解步骤：</strong></p>
<ul>
<li><p>发送请求获取验证码</p>
<ul>
<li>这个问题比较棘手，因为发现，同一个图片地址，每次请求时，其返回的图片都是不一样的</li>
<li>那么他是如何将验证码与登陆关联起来的呢？通过同一会话session关联起来的</li>
</ul>
</li>
<li><p>识别验证码内容</p>
<ul>
<li><p>```python<br>“””<br>图像验证码: 需要获取验证码图片，然后识别图片里面的文本内容，这个就需要用到ocr技术</p>
<p>python中ocr识别库: ddddocr<br>该库是免费的，但是精度不是很高，有的时候会识别错误</p>
<p>如果精度要求比较高，可以找一些第三方收费服务：百度直接搜：打码平台 一般会支持各种类型的验证码识别<br>“””<br>import ddddocr</p>
<h1 id="创建ocr对象"><a href="#创建ocr对象" class="headerlink" title="创建ocr对象"></a>创建ocr对象</h1><p>ocr = ddddocr.DdddOcr()</p>
<h1 id="加载图片"><a href="#加载图片" class="headerlink" title="加载图片"></a>加载图片</h1><p>with open(“1.png”,”rb”) as f:</p>
<pre><code>image = f.read()
</code></pre><h1 id="识别图片内容"><a href="#识别图片内容" class="headerlink" title="识别图片内容"></a>识别图片内容</h1><p>code = ocr.classification(image)<br>print(“识别结果:”,code)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 发送登陆请求</span><br><span class="line"></span><br><span class="line">**破解超级鹰网站登陆页面代码示例**</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">import requests</span><br><span class="line">import ddddocr</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">流程：</span><br><span class="line">    ①请求网站，获取图像验证码图片</span><br><span class="line">    ②调用第三方库识别图像验证码文本</span><br><span class="line">    ③构造请求，发送登陆请求</span><br><span class="line">    </span><br><span class="line">    注意：这整个过程需在同一会话session中进行</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">session = requests.session()</span><br><span class="line"></span><br><span class="line">#获取图形验证码</span><br><span class="line">codeUrl = &quot;https://www.chaojiying.com/include/code/code.php?u=1&quot;</span><br><span class="line">codeImage = session.get(url=codeUrl).content</span><br><span class="line">with open(&quot;code.png&quot;,&quot;wb&quot;) as f:</span><br><span class="line">    f.write(codeImage)</span><br><span class="line">#调用第三方库识别图像验证码</span><br><span class="line">ocr = ddddocr.DdddOcr()</span><br><span class="line">code = ocr.classification(codeImage)</span><br><span class="line">print(&quot;验证码：&quot;,code)</span><br><span class="line">#构造登陆请求</span><br><span class="line">loginUrl = &quot;https://www.chaojiying.com/user/login/&quot;</span><br><span class="line">params=&#123;</span><br><span class="line">    &quot;user&quot;: &quot;HustRich&quot;,</span><br><span class="line">    &quot;pass&quot;: &quot;wu123456&quot;,</span><br><span class="line">    &quot;imgtxt&quot;: code,</span><br><span class="line">    &quot;act&quot;: 1</span><br><span class="line">&#125;</span><br><span class="line">headers=&#123;</span><br><span class="line">    &quot;User-Agent&quot;:&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36&quot;</span><br><span class="line">    # ,&quot;Cookie&quot;:&quot;PHPSESSID=c2s08og1j8244us3qc4ub9d217; __51cke__=; __tins__16851773=%7B%22sid%22%3A%201716036582790%2C%20%22vd%22%3A%203%2C%20%22expires%22%3A%201716039030500%7D; __51laig__=4&quot;</span><br><span class="line">&#125;</span><br><span class="line">response = session.post(url=loginUrl,data=params,headers=headers)</span><br><span class="line">print(response.content)</span><br><span class="line"></span><br><span class="line">with open(&quot;res.html&quot;,&quot;wb&quot;) as f:</span><br><span class="line">    f.write(response.content)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="js逆向：滑动验证码的轨迹破解"><a href="#js逆向：滑动验证码的轨迹破解" class="headerlink" title="js逆向：滑动验证码的轨迹破解"></a>js逆向：滑动验证码的轨迹破解</h3><p>案例网站：<a target="_blank" rel="noopener" href="https://user.qunar.com/passport/login.jsp">去哪儿</a></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518100404382.png" alt="image-20240518100404382" style="zoom: 33%;"></p>
<p><strong>需求分析</strong></p>
<p>我们输入手机号，然后点击获取验证码，会弹出一个滑动验证码窗口，经过验证之后才会收到验证码，然后点击登陆注册，此过程向后端的请求包括：</p>
<ul>
<li>滑动验证码的请求</li>
<li>获取手机验证码的请求</li>
<li>登陆接口的请求</li>
</ul>
<p><strong>滑动验证码请求</strong></p>
<p>只有将滑动验证码拖动到最右端才能成功发送该请求</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518100928636.png" alt="image-20240518100928636"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518100848451.png" alt="image-20240518100848451" style="zoom:50%;"></p>
<p>观察滑动验证码请求参数，发现其中有一个未知的参数 data</p>
<p><strong>手机验证码请求</strong></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518100959013.png" alt="image-20240518100959013" style="zoom:50%;"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518101033801.png" alt="image-20240518101033801"></p>
<p><strong>登陆接口请求</strong></p>
<p>验证码破解相关知识等后续有需求再了解</p>
<h2 id="异步爬虫"><a href="#异步爬虫" class="headerlink" title="异步爬虫"></a>异步爬虫</h2><p>当我们有大量数据需要抓取时，总的抓取时间会比较长，这个时候，如果需要提高数据的抓取效率，需要用到多线程异步并发爬取</p>
<p>该方法缺陷，并发会导致短时间对目标网站服务器大量请求，使得目标网站压力过大，如果被检测，可能触发一系列的反爬机制</p>
<p>该方法一般需要配合代理IP去使用，每次请求从不同ip发出，这样即使访问很频繁，由于请求来自于不同ip，被检测概率会比较低</p>
<h3 id="抓取需求"><a href="#抓取需求" class="headerlink" title="抓取需求"></a>抓取需求</h3><p>目标网站：<a target="_blank" rel="noopener" href="https://www.myfreemp3.com.cn/">https://www.myfreemp3.com.cn/</a></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518104553106.png" alt="image-20240518104553106" style="zoom: 33%;"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518105026649.png" alt="image-20240518105026649" style="zoom:33%;"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518105052266.png" alt="image-20240518105052266" style="zoom:33%;"></p>
<p>我们的目标是抓取该网站上周杰伦所有歌曲</p>
<ul>
<li><p>要求：下载每一首歌曲的封面图、mp3文件，歌词，然后保存在本地，要求保存的格式如下：</p>
<ul>
<li><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518105221295.png" alt="image-20240518105221295" style="zoom:33%;"></li>
</ul>
</li>
<li><p>子目录名为各个歌曲名，里面包含mp3文件、封面图png，歌词文本txt文件</p>
</li>
</ul>
<h4 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h4><h4 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h4><ul>
<li>先抓取搜索歌手所有的歌曲，提取歌曲名、歌手、封面图、歌词信息</li>
<li>然后再去下载歌曲、封面、歌词保存为文件</li>
</ul>
<h4 id="获取歌曲列表接口"><a href="#获取歌曲列表接口" class="headerlink" title="获取歌曲列表接口"></a>获取歌曲列表接口</h4><p>抓包分析：</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518110007948.png" alt="image-20240518110007948" style="zoom:33%;"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518110055152.png" alt="image-20240518110055152" style="zoom:33%;"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518110125909.png" alt="image-20240518110125909" style="zoom:33%;"></p>
<p><img src="03 爬虫进阶//image-20240518110235118.png" alt="image-20240518110235118" style="zoom:33%;"></p>
<p>歌曲列表接口：</p>
<blockquote>
<p>url地址：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.myfreemp3.com.cn/">https://www.myfreemp3.com.cn/</a></li>
</ul>
<p>请求方法：</p>
<ul>
<li>POST</li>
</ul>
<p>参数：</p>
<ul>
<li>input: 歌手名</li>
<li>filter: name</li>
<li>page: 页码</li>
<li>type: netease</li>
</ul>
<p>返回响应:</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518110437045.png" alt="image-20240518110437045" style="zoom:50%;"></p>
</blockquote>
<h4 id="单线程下载"><a href="#单线程下载" class="headerlink" title="单线程下载"></a>单线程下载</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">分析:</span></span><br><span class="line"><span class="string">    抓取网站:https://www.myfreemp3.com.cn/ 中指定歌手的歌曲:</span></span><br><span class="line"><span class="string">        下载数据包括: 歌曲封面图片、歌曲歌词文本文件，歌曲mp3资源文件</span></span><br><span class="line"><span class="string">        文件存储格式:</span></span><br><span class="line"><span class="string">            歌手名:</span></span><br><span class="line"><span class="string">                歌曲名:</span></span><br><span class="line"><span class="string">                    歌曲名_作者.png</span></span><br><span class="line"><span class="string">                    歌曲名_作者.txt</span></span><br><span class="line"><span class="string">                    歌曲名_作者.mp3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CrawMusic</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,baseDir</span>):</span><br><span class="line">        self.url = <span class="string">&quot;https://www.myfreemp3.com.cn&quot;</span></span><br><span class="line">        self.headers=&#123;</span><br><span class="line">                <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">                ,<span class="string">&quot;X-Requested-With&quot;</span>:<span class="string">&quot;XMLHttpRequest&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">        self.params=&#123;</span><br><span class="line">            <span class="string">&quot;input&quot;</span>: <span class="string">&quot;周杰伦&quot;</span>,</span><br><span class="line">            <span class="string">&quot;filter&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">            <span class="string">&quot;page&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;netease&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        self.baseDir = baseDir</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sendRequest</span>(<span class="params">self,name,pageIndex</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :param name: 歌手姓名</span></span><br><span class="line"><span class="string">        :param pageIndex: 当前页码</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.params[<span class="string">&quot;name&quot;</span>]=name</span><br><span class="line">        self.params[<span class="string">&quot;page&quot;</span>]=pageIndex</span><br><span class="line">        response = requests.post(url=self.url, data=self.params, headers=self.headers)</span><br><span class="line"></span><br><span class="line">        data = response.json()[<span class="string">&quot;data&quot;</span>][<span class="string">&quot;list&quot;</span>]</span><br><span class="line">        curSaveDir = os.path.join(self.baseDir,name)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(curSaveDir):</span><br><span class="line">            os.makedirs(curSaveDir)</span><br><span class="line">            self.parseData(curSaveDir,data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parseData</span>(<span class="params">self,curSaveDir,data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :param curSaveDir: 该歌手数据存储根目录</span></span><br><span class="line"><span class="string">        :param data: 需要被解析的数据</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">            <span class="comment"># 歌词标题</span></span><br><span class="line">            title = item[<span class="string">&quot;title&quot;</span>]</span><br><span class="line">            <span class="comment"># 作者</span></span><br><span class="line">            author = item[<span class="string">&quot;author&quot;</span>]</span><br><span class="line">            <span class="comment"># 封面图片链接</span></span><br><span class="line">            pic = item[<span class="string">&quot;pic&quot;</span>]</span><br><span class="line">            <span class="comment"># 歌词文本</span></span><br><span class="line">            tex = item[<span class="string">&quot;lrc&quot;</span>]</span><br><span class="line">            <span class="comment"># 歌词下载链接</span></span><br><span class="line">            mp3Link = item[<span class="string">&quot;url&quot;</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment">#当前歌曲数据存储路径</span></span><br><span class="line">            curMusicSaveDir = os.path.join(curSaveDir, title)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(curMusicSaveDir):</span><br><span class="line">                os.mkdir(curMusicSaveDir)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;benign dowmload &#123;&#125;&quot;</span>.<span class="built_in">format</span>(title))</span><br><span class="line">                <span class="comment"># 图片</span></span><br><span class="line">                curPicSavePath = os.path.join(curMusicSaveDir, title + <span class="string">&quot;.png&quot;</span>)</span><br><span class="line">                self.downloadFile(pic, curPicSavePath)</span><br><span class="line">                <span class="comment"># 歌词</span></span><br><span class="line">                curTexSavePath = os.path.join(curMusicSaveDir, title + <span class="string">&quot;.txt&quot;</span>)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(curTexSavePath, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.write(tex)</span><br><span class="line">                <span class="comment"># MP3</span></span><br><span class="line">                curMp3SavePath = os.path.join(curMusicSaveDir, title + <span class="string">&quot;.mp3&quot;</span>)</span><br><span class="line">                self.downloadFile(mp3Link, curMp3SavePath)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;歌曲&#123;&#125;已被下载，无需重复下载&quot;</span>.<span class="built_in">format</span>(title))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">downloadFile</span>(<span class="params">self,url, path</span>):</span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(response.content)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(url+<span class="string">&quot; 下载失败&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    crawDownload = CrawMusic(<span class="string">r&quot;E:\tempData\musics&quot;</span>)</span><br><span class="line">    crawDownload.sendRequest(<span class="string">&quot;周杰伦&quot;</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h4 id="异步下载"><a href="#异步下载" class="headerlink" title="异步下载"></a>异步下载</h4><p>上面代码是单线程下载，而且只是下载单页数据，当需要下载大量数据时，就必须采用多线程异步下载</p>
<p>整个爬虫其实主要分为以下三个模块：</p>
<ul>
<li>发送请求获取响应</li>
<li>数据解析</li>
<li>数据存储</li>
<li>如下图所示，对于这三个模块我们可以进行异步处理，模块一线程请求后的数据进入一个管道，模块二线程从管道中拿取数据进行解析，然后解析后的结果放入另一个管道，模块三线程从管道二中拿取解析后的数据进行存储，这个过程，三个模块相互独立，如果哪个部分耗时较多，可以采用多线程进行处理</li>
</ul>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518182355861.png" alt="image-20240518182355861" style="zoom:50%;"></p>
<p><strong>多线程代码示例</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">分析:</span></span><br><span class="line"><span class="string">    抓取网站:https://www.myfreemp3.com.cn/ 中指定歌手的歌曲:</span></span><br><span class="line"><span class="string">        下载数据包括: 歌曲封面图片、歌曲歌词文本文件，歌曲mp3资源文件</span></span><br><span class="line"><span class="string">        文件存储格式:</span></span><br><span class="line"><span class="string">            歌手名:</span></span><br><span class="line"><span class="string">                歌曲名:</span></span><br><span class="line"><span class="string">                    歌曲名_作者.png</span></span><br><span class="line"><span class="string">                    歌曲名_作者.txt</span></span><br><span class="line"><span class="string">                    歌曲名_作者.mp3</span></span><br><span class="line"><span class="string">    并发下载:</span></span><br><span class="line"><span class="string">        请求、数据解析、数据存储三个部分用多个不同线程处理</span></span><br><span class="line"><span class="string">        各个线程之间用 queue.Queue来进行数据传递，该对象是线程安全的</span></span><br><span class="line"><span class="string">        queue的用法参考:https://blog.csdn.net/songpeiying/article/details/131761990</span></span><br><span class="line"><span class="string">        queue = queue.Queue()</span></span><br><span class="line"><span class="string">        queue.put() 添加数据  使用put()方法将元素放入队列。如果队列已满，put()方法会阻塞直到有空余空间</span></span><br><span class="line"><span class="string">        queue.get() 获取数据  使用get()方法从队列中取出元素。如果队列为空，get()方法会阻塞直到有元素可用</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        queue.get(timeout=xx) 等待xx秒如果还未获取数据则会报错，如果不添加timeout参数则会一直阻塞</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">from</span> concurrent.futures.thread <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CrawMusic</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,baseDir</span>):</span><br><span class="line">        self.url = <span class="string">&quot;https://www.myfreemp3.com.cn&quot;</span></span><br><span class="line">        self.headers=&#123;</span><br><span class="line">                <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">                ,<span class="string">&quot;X-Requested-With&quot;</span>:<span class="string">&quot;XMLHttpRequest&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">        self.params=&#123;</span><br><span class="line">            <span class="string">&quot;input&quot;</span>: <span class="string">&quot;周杰伦&quot;</span>,</span><br><span class="line">            <span class="string">&quot;filter&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">            <span class="string">&quot;page&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;netease&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        self.baseDir = baseDir</span><br><span class="line">        <span class="comment">#响应数据类管道</span></span><br><span class="line">        self.responseDataQueue = queue.Queue()</span><br><span class="line">        <span class="comment">#解析数据管道</span></span><br><span class="line">        self.parseDataQueue = queue.Queue()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sendRequest</span>(<span class="params">self,name,pageIndex</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :param name: 歌手姓名</span></span><br><span class="line"><span class="string">        :param pageIndex: 当前页码</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.params[<span class="string">&quot;input&quot;</span>]=name</span><br><span class="line">        self.params[<span class="string">&quot;page&quot;</span>]=pageIndex</span><br><span class="line">        response = requests.post(url=self.url, data=self.params, headers=self.headers)</span><br><span class="line"></span><br><span class="line">        data = response.json()[<span class="string">&quot;data&quot;</span>][<span class="string">&quot;list&quot;</span>]</span><br><span class="line">        curSaveDir = os.path.join(self.baseDir,name)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(curSaveDir):</span><br><span class="line">            os.makedirs(curSaveDir)</span><br><span class="line">        self.responseDataQueue.put((curSaveDir,data))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parseData</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :param curSaveDir: 该歌手数据存储根目录</span></span><br><span class="line"><span class="string">        :param data: 需要被解析的数据</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                curSaveDir, data = self.responseDataQueue.get(timeout=<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">except</span> queue.Empty:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">                <span class="comment"># 歌词标题</span></span><br><span class="line">                title = item[<span class="string">&quot;title&quot;</span>]</span><br><span class="line">                <span class="comment"># 作者</span></span><br><span class="line">                author = item[<span class="string">&quot;author&quot;</span>]</span><br><span class="line">                <span class="comment"># 封面图片链接</span></span><br><span class="line">                pic = item[<span class="string">&quot;pic&quot;</span>]</span><br><span class="line">                <span class="comment"># 歌词文本</span></span><br><span class="line">                tex = item[<span class="string">&quot;lrc&quot;</span>]</span><br><span class="line">                <span class="comment"># 歌词下载链接</span></span><br><span class="line">                mp3Link = item[<span class="string">&quot;url&quot;</span>]</span><br><span class="line"></span><br><span class="line">                <span class="comment">#当前歌曲数据存储路径</span></span><br><span class="line">                curMusicSaveDir = os.path.join(curSaveDir, title)</span><br><span class="line">                self.parseDataQueue.put((curMusicSaveDir,title,author,pic,tex,mp3Link))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">saveData</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                curMusicSaveDir, title, author,pic, tex, mp3Link = self.parseDataQueue.get(timeout=<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">except</span> queue.Empty:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(curMusicSaveDir):</span><br><span class="line">                os.mkdir(curMusicSaveDir)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;benign dowmload &#123;&#125;&quot;</span>.<span class="built_in">format</span>(title))</span><br><span class="line">                <span class="comment"># 图片</span></span><br><span class="line">                curPicSavePath = os.path.join(curMusicSaveDir, title +<span class="string">&quot;_&quot;</span>+author+ <span class="string">&quot;.png&quot;</span>)</span><br><span class="line">                self.downloadFile(pic, curPicSavePath)</span><br><span class="line">                <span class="comment"># 歌词</span></span><br><span class="line">                curTexSavePath = os.path.join(curMusicSaveDir, title +<span class="string">&quot;_&quot;</span>+author+ <span class="string">&quot;.txt&quot;</span>)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(curTexSavePath, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.write(tex)</span><br><span class="line">                <span class="comment"># MP3</span></span><br><span class="line">                curMp3SavePath = os.path.join(curMusicSaveDir, title +<span class="string">&quot;_&quot;</span>+author+ <span class="string">&quot;.mp3&quot;</span>)</span><br><span class="line">                self.downloadFile(mp3Link, curMp3SavePath)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;歌曲&#123;&#125;已被下载，无需重复下载&quot;</span>.<span class="built_in">format</span>(title))</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">downloadFile</span>(<span class="params">self,url, path</span>):</span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(response.content)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(url+<span class="string">&quot; 下载失败&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    crawDownload = CrawMusic(<span class="string">r&quot;E:\tempData\musics&quot;</span>)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    多线程，我们采用线程池来进行处理</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> ThreadPoolExecutor(max_workers=<span class="number">5</span>) <span class="keyword">as</span> pool:</span><br><span class="line">        pool.submit(crawDownload.sendRequest,<span class="string">&quot;蔡依林&quot;</span>,<span class="number">1</span>)</span><br><span class="line">        pool.submit(crawDownload.parseData)</span><br><span class="line">        <span class="comment">#save data比较耗时，采用三个线程</span></span><br><span class="line">        pool.submit(crawDownload.saveData)</span><br><span class="line">        pool.submit(crawDownload.saveData)</span><br><span class="line">        pool.submit(crawDownload.saveData)</span><br></pre></td></tr></table></figure>
<h2 id="Cookie池和IP代理"><a href="#Cookie池和IP代理" class="headerlink" title="Cookie池和IP代理"></a>Cookie池和IP代理</h2><p>多线程并发存在问题：同一时间向目标服务器发送请求过多，且请求来自于同一客户端，容易被对方察觉，触发反爬机制导致失败</p>
<h3 id="代理IP的使用"><a href="#代理IP的使用" class="headerlink" title="代理IP的使用"></a>代理IP的使用</h3><h4 id="代理IP的基本概念"><a href="#代理IP的基本概念" class="headerlink" title="代理IP的基本概念"></a>代理IP的基本概念</h4><h5 id="背景：为什么要使用代理"><a href="#背景：为什么要使用代理" class="headerlink" title="背景：为什么要使用代理"></a>背景：为什么要使用代理</h5><ul>
<li>一段时间内，检测IP访问频率，访问太频繁会被识别成爬虫被对方屏蔽</li>
<li>使用代理IP可以让服务器以为不是同一客户端在请求</li>
<li>防止我们真实的IP地址被泄露，被追究</li>
</ul>
<h5 id="使用代理的请求过程"><a href="#使用代理的请求过程" class="headerlink" title="使用代理的请求过程"></a>使用代理的请求过程</h5><p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518190455761.png" alt="image-20240518190455761" style="zoom:50%;"></p>
<h4 id="代理IP的获取"><a href="#代理IP的获取" class="headerlink" title="代理IP的获取"></a>代理IP的获取</h4><p>目前有许多平台会提供代理IP的服务，且一般注册之后都会赠送一些免费使用的额度</p>
<h4 id="代理IP平台"><a href="#代理IP平台" class="headerlink" title="代理IP平台"></a><strong>代理IP平台</strong></h4><ul>
<li>天启  <a target="_blank" rel="noopener" href="https://www.tianqiip.com/getIp">https://www.tianqiip.com/getIp</a><ul>
<li><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518191323650.png" alt="image-20240518191323650" style="zoom: 33%;"></li>
</ul>
</li>
</ul>
<h4 id="在python代码中如何配置代理"><a href="#在python代码中如何配置代理" class="headerlink" title="在python代码中如何配置代理"></a>在python代码中如何配置代理</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.baidu.com&quot;</span></span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">ip =<span class="string">&quot;122.239.153.110&quot;</span></span><br><span class="line">port =<span class="number">40020</span></span><br><span class="line">proxies=&#123;</span><br><span class="line">    <span class="string">&quot;http&quot;</span>:<span class="string">f&quot;htpp://<span class="subst">&#123;ip&#125;</span>.<span class="subst">&#123;port&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#通过参数 proxies配置代理</span></span><br><span class="line">response = requests.get(url=url,headers=headers,proxies=proxies)</span><br><span class="line"><span class="built_in">print</span>(proxies)</span><br><span class="line"><span class="built_in">print</span>(response.content)</span><br></pre></td></tr></table></figure>
<h4 id="动态ip池"><a href="#动态ip池" class="headerlink" title="动态ip池"></a>动态ip池</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">天启平台有教程，更具生成的api链接发送get请求可以获取代理Ip列表</span></span><br><span class="line"><span class="string">每次在爬虫时，随机从列表中选择一个代理ip</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpiderCraw</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.proxyGetUrl = <span class="string">&quot;http://api.tianqiip.com/getip?secret=ka9cjsm0egycakir&amp;num=10&amp;type=json&amp;port=1&amp;time=5&amp;mr=1&amp;sign=d50e433630f39d20c428a0d5c6c033e7&quot;</span></span><br><span class="line">        self.ipList = requests.get(self.proxyGetUrl).json()[<span class="string">&quot;data&quot;</span>]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getProxyIp</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> random.choice(self.ipList)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getSendRequest</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#每次发送请求，从ip池中随机选择一个代理ip</span></span><br><span class="line">        proxyIp = self.getProxyIp()</span><br><span class="line">        proxies = &#123;</span><br><span class="line">            <span class="string">&quot;http&quot;</span>:<span class="string">&quot;http://&#123;&#125;:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(proxyIp[<span class="string">&quot;ip&quot;</span>],proxyIp[<span class="string">&quot;port&quot;</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        url = <span class="string">&quot;https://www.baidu.com&quot;</span></span><br><span class="line">        requests.get(url=url,proxies=proxies)</span><br><span class="line">url =</span><br><span class="line">ipPool = requests.get(url)</span><br><span class="line"><span class="built_in">print</span>(ipPool.json()[<span class="string">&quot;data&quot;</span>])</span><br></pre></td></tr></table></figure>
<h3 id="Cookie池的搭建"><a href="#Cookie池的搭建" class="headerlink" title="Cookie池的搭建"></a>Cookie池的搭建</h3><h4 id="爬虫中使用cookie的利弊"><a href="#爬虫中使用cookie的利弊" class="headerlink" title="爬虫中使用cookie的利弊"></a>爬虫中使用cookie的利弊</h4><h5 id="带上cookie好处"><a href="#带上cookie好处" class="headerlink" title="带上cookie好处"></a>带上cookie好处</h5><ul>
<li>能够访问登陆后的页面</li>
<li>能够实现部分反爬</li>
</ul>
<h4 id="带上cookie的坏处"><a href="#带上cookie的坏处" class="headerlink" title="带上cookie的坏处"></a>带上cookie的坏处</h4><ul>
<li>一套cookie往往对应一个用户的信息，请求太频繁容易被对方识别为爬虫</li>
<li>上面问题如何解决？使用多个账号，每次请求的cookie不一样即可</li>
</ul>
<h4 id="cookie池的搭建"><a href="#cookie池的搭建" class="headerlink" title="cookie池的搭建"></a>cookie池的搭建</h4><h4 id="思路分析-1"><a href="#思路分析-1" class="headerlink" title="思路分析"></a>思路分析</h4><ul>
<li>主备多个账号，越多越好</li>
<li>爬取数据之前对这些账号进行批量登录，并将cookie保存在本地cookie池中<ul>
<li>需要登陆账号的可以这么做</li>
<li>不需要登陆账号的，可以启动多个浏览器，手动登陆，然后将cookie值复制存储在本地</li>
</ul>
</li>
<li>爬虫执行之后，每次从cookie池中随机选择一个cookie</li>
</ul>
<p><strong>示例代码</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CookieManager</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.cookieList=[]</span><br><span class="line">        <span class="comment">#实现准备一组账号密码</span></span><br><span class="line">        self.userInfoList=[</span><br><span class="line">            &#123;<span class="string">&quot;userName&quot;</span>: <span class="string">&quot;123321&quot;</span>,<span class="string">&quot;password&quot;</span>: <span class="string">&quot;wwxxx1&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;userName&quot;</span>: <span class="string">&quot;123322&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;wwxxx2&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;userName&quot;</span>: <span class="string">&quot;123323&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;wwxxx3&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;userName&quot;</span>: <span class="string">&quot;123324&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;wwxxx4&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;userName&quot;</span>: <span class="string">&quot;123325&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;wwxxx5&quot;</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">for</span> userInfo <span class="keyword">in</span> self.userInfoList:</span><br><span class="line">            self.loginGetCookie(userInfo)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> self.cookieList:</span><br><span class="line">            <span class="built_in">print</span>(item)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">loginGetCookie</span>(<span class="params">self,userInfo</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        登陆函数，并从响应中获取cookie，然后保存在cookie池中</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        url=<span class="string">&quot;https://passport.china.com/logon&quot;</span></span><br><span class="line">        response = requests.post(url,data=userInfo)</span><br><span class="line">        self.cookieList.append(response.cookies)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getCookie</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        供外部使用，随机从cookie池中选择一个cookie</span></span><br><span class="line"><span class="string">        外部使用时:直接在requests中以cookies参数进行传递</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> random.choice(self.cookieList)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    cookieManager = CookieManager()</span><br><span class="line">    <span class="built_in">print</span>(cookieManager.getCookie())</span><br></pre></td></tr></table></figure>
<h3 id="Cookie池-IP池"><a href="#Cookie池-IP池" class="headerlink" title="Cookie池+IP池"></a>Cookie池+IP池</h3><p>同一个IP使用不同的Cookie，还是会出现同一个IP频繁请求，如果每个Cookie都绑定一组代理IP，这个时候就很难会被检测出来</p>
<p>基本思路：用不同ip去登陆不同账号，得到不同cookie，这样每一个代理Ipd都会对应多个cookie，在爬虫启动时，每次从ip_cookei池中选择一个ip，cookie对</p>
<h2 id="综合项目实战案例"><a href="#综合项目实战案例" class="headerlink" title="综合项目实战案例"></a>综合项目实战案例</h2><h3 id="需求分析-1"><a href="#需求分析-1" class="headerlink" title="需求分析"></a>需求分析</h3><p>某原创音乐网站数据抓取</p>
<p>需求：抓取某原创音乐平台整站数据</p>
<p>地址：<a target="_blank" rel="noopener" href="https://5sing.kugou.com/">https://5sing.kugou.com/</a></p>
<p>分页抓取该网站所有的原创音乐数据，一共50页</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518222840513.png" alt="image-20240518222840513" style="zoom: 33%;"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518222855995.png" alt="image-20240518222855995" style="zoom:33%;"></p>
<h3 id="抓包分析"><a href="#抓包分析" class="headerlink" title="抓包分析"></a><strong>抓包分析</strong></h3><p>通过抓包分析，我们发现该网站数据不是Ajax请求，直接抓取请求页面即可获取对应数据</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518223255287.png" alt="image-20240518223255287" style="zoom:50%;"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518223819051.png" alt="image-20240518223819051" style="zoom:50%;"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518224023061.png" alt="image-20240518224023061"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240518230616148.png" alt="image-20240518230616148"></p>
<h3 id="思路分析-2"><a href="#思路分析-2" class="headerlink" title="思路分析"></a>思路分析</h3><ol>
<li>获取歌曲列表、提取歌曲的歌名、歌曲首页地址<ol>
<li>发送请求，获取页面的HTML</li>
<li>解析HTML，提取歌名和歌曲ID、首页地址</li>
</ol>
</li>
<li>获取每首歌的下载地址<ol>
<li>发送请求获取歌曲的下载地址</li>
</ol>
</li>
<li>下载歌曲，保存在本地<ol>
<li>下载歌曲，保存本地</li>
</ol>
</li>
</ol>
<p>数据量分析：一共50页，每页20条数据，要完整的下载一首歌的话，需要通过两次请求，第一次请求页面，获取歌曲id，第二次针对该歌曲地址，将其下载到本地</p>
<h3 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h3><h4 id="爬取所有歌曲的名称和id数据"><a href="#爬取所有歌曲的名称和id数据" class="headerlink" title="爬取所有歌曲的名称和id数据"></a>爬取所有歌曲的名称和id数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://5sing.kugou.com/yc/list&quot;</span></span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#参数，经过分析，前三个参数应该是固定的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">    params=&#123;</span><br><span class="line">        <span class="string">&quot;t&quot;</span>:<span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;l&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;s&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;p&quot;</span>:page  <span class="comment">#页码</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = requests.get(url=url,headers=headers,params=params).content.decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#解析htm，获取歌曲名称、链接地址</span></span><br><span class="line">    html = etree.HTML(response)</span><br><span class="line">    dlList = html.xpath(<span class="string">&#x27;//div[@class=&quot;lists&quot;]/dl&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> dlItem <span class="keyword">in</span> dlList:</span><br><span class="line">        title = dlItem.xpath(<span class="string">&#x27;.//h3/a/text()&#x27;</span>)[<span class="number">0</span>] <span class="comment">#名称</span></span><br><span class="line">        url = <span class="string">&#x27;https://5sing.kugou.com&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(dlItem.xpath(<span class="string">&#x27;.//h3/a/@href&#x27;</span>)[<span class="number">0</span>]) <span class="comment">#首页地址</span></span><br><span class="line">        <span class="built_in">id</span> = dlItem.xpath(<span class="string">&#x27;./dd[@class=&quot;l_action&quot;]/a[@class=&quot;m_date_shou&quot;]/@argid&#x27;</span>)[<span class="number">0</span>]<span class="comment">#id</span></span><br><span class="line">        <span class="built_in">print</span>(title,url,<span class="built_in">id</span>)</span><br></pre></td></tr></table></figure>
<h4 id="获取各个歌曲源文件的下载地址"><a href="#获取各个歌曲源文件的下载地址" class="headerlink" title="获取各个歌曲源文件的下载地址"></a>获取各个歌曲源文件的下载地址</h4><p>&gt;<br>&gt;</p>
<blockquote>
<p>抓包分析</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240519000844468.png" alt="image-20240519000844468" style="zoom: 33%;"></p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240519001011699.png" alt="image-20240519001011699" style="zoom:33%;"></p>
<p>两个不同歌曲请求的参数对比：</p>
<p>我们发现只有songid和signature这两个参数不一样，songid即为我们前面抓取的歌曲id，而难点就在于signature不知从何而来</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240519001105427.png" alt="image-20240519001105427"></p>
</blockquote>
<p>难点：参数signature不知从何而来，这个可能可能设计到js加密</p>
<p>如何分析网站生成signature的js代码？</p>
<p>在所有源代码中搜索signature</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240519002901327.png" alt="image-20240519002901327"></p>
<p> 定位到该位置</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240519003003459.png" alt="image-20240519003003459" style="zoom: 80%;"></p>
<p>我们在控制台执行，发现n的值为</p>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240519003149366.png" alt="image-20240519003149366"></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">n的结构：</span><br><span class="line">字符串: o = &quot;5uytoxQewcvIc1gn1PlNF0T2jbbOzRl&quot;</span><br><span class="line">与请求参数的子字符串事项首位拼接得到拼接得到</span><br><span class="line"></span><br><span class="line">即 n = o + params +o</span><br><span class="line">我们经过多次实验发现字符串o为定值，不同请求、不同浏览器该值都是一致的</span><br></pre></td></tr></table></figure>
<p>这个js代码比较复杂，我们无法用python代码等价复现，只能将js代码拷贝至本地，由python调用执行</p>
<h2 id="其他补充知识"><a href="#其他补充知识" class="headerlink" title="其他补充知识"></a>其他补充知识</h2><h3 id="免费邮箱资源"><a href="#免费邮箱资源" class="headerlink" title="免费邮箱资源"></a>免费邮箱资源</h3><p>针对账户限制，注册账号需要大量邮箱进行注册新的账号</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/julius_lee/article/details/106802027">需要很多邮箱怎么办？分享几个不错的办法可无限安全生成多个邮箱</a></p>
<h3 id="免费代理IP资源"><a href="#免费代理IP资源" class="headerlink" title="免费代理IP资源"></a>免费代理IP资源</h3><p>设置自己本地的梯子IP地址：</p>
<p>打开clash软件，查看代理端口为7890，在代码首部添加如下代码，即可使用本地代理转发</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置代理</span></span><br><span class="line">os.environ[<span class="string">&quot;http_proxy&quot;</span>] = <span class="string">&quot;http://localhost:7890&quot;</span></span><br><span class="line">os.environ[<span class="string">&quot;https_proxy&quot;</span>] = <span class="string">&quot;http://localhost:7890&quot;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/image-20240604093135783.png" alt="image-20240604093135783"></p>
<p><a target="_blank" rel="noopener" href="https://www.bytezonex.com/archives/8ZwHxBGP.html">参考资料一</a></p>
<h3 id="网站指纹反爬"><a href="#网站指纹反爬" class="headerlink" title="网站指纹反爬"></a>网站指纹反爬</h3><h4 id="背景-4"><a href="#背景-4" class="headerlink" title="背景"></a>背景</h4><p>我们使用<code>requests</code>库访问网站<a target="_blank" rel="noopener" href="https://www.digikey.cn时，无论怎么设置头部信息，均是返回403页面，但是用浏览器或者PostMan访问时，均可得到正常的页面结果，这种情况大概率就是遇到了**原生模拟浏览器">https://www.digikey.cn时，无论怎么设置头部信息，均是返回403页面，但是用浏览器或者PostMan访问时，均可得到正常的页面结果，这种情况大概率就是遇到了**原生模拟浏览器</a> TLS/JA3 指纹的验证**，览器和<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=postman&amp;spm=1001.2101.3001.7020">postman</a>都有自带指纹验证，而唯独requests库没有。</p>
<h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><p>使用第三方库<code>curl_cffi</code>访问，即可解决这个问题，其可以模仿对浏览器指纹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> curl_cffi <span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">r = requests.get(<span class="string">&quot;https://www.digikey.cn&quot;</span>, impersonate=<span class="string">&quot;chrome110&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.content.decode(<span class="string">&quot;utf8&quot;</span>))</span><br></pre></td></tr></table></figure>
<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lipachong/article/details/131213288">某网站指纹反爬处理</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1nz421X7r8/?spm_id_from=333.337.search-card.all.click&amp;vd_source=91a99cf2cdc8a7bec61c79b14c7a9800">JS逆向_浏览器JA3指纹信息</a></p>
<p><a target="_blank" rel="noopener" href="https://pypi.org/project/curl-cffi/#description">curl-cffif官方文档</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://bangwu2001.github.io">Bang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://bangwu2001.github.io/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/">https://bangwu2001.github.io/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/03%20%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://bangwu2001.github.io" target="_blank">Bang's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python/">python</a></div><div class="post_share"><div class="social-share" data-image="/img/post/post_1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/05/07/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/AI%E7%9B%B8%E5%85%B3/02%20Spring%20AI/Spring%20AI/" title="SPring AI"><img class="cover" src="/img/post/post_2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SPring AI</div></div></a></div><div class="next-post pull-right"><a href="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/02%20%E7%88%AC%E8%99%AB%E6%A6%82%E8%BF%B0/" title="爬虫概述"><img class="cover" src="/img/post/post_1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">爬虫概述</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/01%20pycharm%E5%BF%AB%E6%8D%B7/" title="pycharm快捷键"><img class="cover" src="/img/post/post_2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-21</div><div class="title">pycharm快捷键</div></div></a></div><div><a href="/2024/05/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/%E6%A1%86%E6%9E%B6%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/python/%E7%88%AC%E8%99%AB/02%20%E7%88%AC%E8%99%AB%E6%A6%82%E8%BF%B0/" title="爬虫概述"><img class="cover" src="/img/post/post_1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-21</div><div class="title">爬虫概述</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6"><span class="toc-number">1.</span> <span class="toc-text">爬虫进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%88%AC%E8%99%AB%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">爬虫概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2%E6%8A%93%E5%8F%96%EF%BC%9A"><span class="toc-number">1.2.</span> <span class="toc-text">静态页面抓取：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#request%E6%9E%84%E9%80%A0%E8%AF%B7%E6%B1%82%EF%BC%9A"><span class="toc-number">1.3.</span> <span class="toc-text">request构造请求：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E7%99%BB%E9%99%86%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="toc-number">1.4.</span> <span class="toc-text">模拟登陆场景：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95%E4%B8%AD%E5%8D%8E%E7%BD%91"><span class="toc-number">1.4.1.</span> <span class="toc-text">模拟登录中华网</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ajax%E5%BC%82%E6%AD%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">1.5.</span> <span class="toc-text">Ajax异步数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E6%95%B0%E6%8D%AE%E6%8A%93%E5%8F%96%E6%A1%88%E4%BE%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">异步数据抓取案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2%E9%97%AE%E9%A2%98"><span class="toc-number">1.6.</span> <span class="toc-text">数据格式转换问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#json%E6%A8%A1%E5%9D%97"><span class="toc-number">1.6.1.</span> <span class="toc-text">json模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jsonPath"><span class="toc-number">1.6.2.</span> <span class="toc-text">jsonPath</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9Ajsonpath%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96"><span class="toc-number">1.6.3.</span> <span class="toc-text">案例：jsonpath进行数据提取</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E9%A2%91%E6%8A%93%E5%8F%96"><span class="toc-number">1.7.</span> <span class="toc-text">视频抓取</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#B%E7%AB%99%E8%A7%86%E9%A2%91%E6%8A%93%E5%8F%96"><span class="toc-number">1.7.1.</span> <span class="toc-text">B站视频抓取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E6%8A%93%E5%8F%96"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">资源抓取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%86%E9%A2%91%E5%90%88%E6%88%90"><span class="toc-number">1.7.1.2.</span> <span class="toc-text">视频合成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.7.1.3.</span> <span class="toc-text">代码示例:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%96%E9%9F%B3%E8%A7%86%E9%A2%91%E6%8A%93%E5%8F%96"><span class="toc-number">1.7.2.</span> <span class="toc-text">抖音视频抓取</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#selenium%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.8.</span> <span class="toc-text">selenium的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.8.1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Selenium%E7%9A%84%E4%B8%80%E8%88%AC%E6%B5%81%E7%A8%8B"><span class="toc-number">1.8.2.</span> <span class="toc-text">使用Selenium的一般流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#selenium%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="toc-number">1.8.3.</span> <span class="toc-text">selenium环境安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#selenium%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">1.8.4.</span> <span class="toc-text">selenium基本用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Selenium-driver%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7"><span class="toc-number">1.8.5.</span> <span class="toc-text">Selenium driver对象的相关属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#selenium%E5%85%83%E7%B4%A0%E5%AE%9A%E4%BD%8D%E5%92%8C%E7%AD%89%E5%BE%85"><span class="toc-number">1.8.6.</span> <span class="toc-text">selenium元素定位和等待</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E5%AE%9A%E4%BD%8D%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">1.8.6.1.</span> <span class="toc-text">元素定位的方法：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E6%93%8D%E4%BD%9C"><span class="toc-number">1.8.6.2.</span> <span class="toc-text">元素的属性和操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E5%B1%9E%E6%80%A7"><span class="toc-number">1.8.6.2.1.</span> <span class="toc-text">元素属性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">1.8.6.2.2.</span> <span class="toc-text">元素的操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#selenium%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95%E6%A1%88%E4%BE%8B"><span class="toc-number">1.8.7.</span> <span class="toc-text">selenium模拟登录案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#selenium%E7%88%AC%E5%8F%96%E6%95%B0%E6%8D%AE%E6%A1%88%E4%BE%8B"><span class="toc-number">1.8.8.</span> <span class="toc-text">selenium爬取数据案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#selenium%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">1.9.</span> <span class="toc-text">selenium进阶使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%89%E5%BE%85%E6%9C%BA%E5%88%B6"><span class="toc-number">1.9.1.</span> <span class="toc-text">等待机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF-1"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%89%E5%BE%85%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.9.1.2.</span> <span class="toc-text">等待的三种方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%BA%E5%88%B6%E7%AD%89%E5%BE%85"><span class="toc-number">1.9.1.3.</span> <span class="toc-text">强制等待</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%90%E5%BC%8F%E7%AD%89%E5%BE%85"><span class="toc-number">1.9.1.4.</span> <span class="toc-text">隐式等待</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E7%AD%89%E5%BE%85"><span class="toc-number">1.9.1.5.</span> <span class="toc-text">显示等待</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%98%BE%E7%A4%BA%E7%AD%89%E5%BE%85%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.9.1.5.1.</span> <span class="toc-text">常用显示等待条件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AD%89%E5%BE%85%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.9.1.5.2.</span> <span class="toc-text">等待条件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iframe%E5%88%87%E6%8D%A2"><span class="toc-number">1.9.2.</span> <span class="toc-text">iframe切换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF-2"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#selenium%E6%8E%A7%E5%88%B6iframe%E5%88%87%E6%8D%A2"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">selenium控制iframe切换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">1.9.2.3.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E6%BB%9A%E5%8A%A8"><span class="toc-number">1.9.3.</span> <span class="toc-text">窗口滚动</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF-3"><span class="toc-number">1.9.3.1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">1.9.3.2.</span> <span class="toc-text">代码示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JS%E6%A8%A1%E6%8B%9F%E6%BB%9A%E5%8A%A8%E9%A1%B5%E9%9D%A2"><span class="toc-number">1.9.4.</span> <span class="toc-text">JS模拟滚动页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">2.</span> <span class="toc-text">参数说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E6%93%8D%E4%BD%9C"><span class="toc-number">2.0.1.</span> <span class="toc-text">鼠标操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#selenium%E6%90%BA%E5%B8%A6cookie%E7%99%BB%E5%BD%95"><span class="toc-number">2.0.2.</span> <span class="toc-text">selenium携带cookie登录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#selenium%E7%89%B9%E5%BE%81%E6%A3%80%E6%B5%8B"><span class="toc-number">2.1.</span> <span class="toc-text">selenium特征检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#selenium%E5%90%AF%E5%8A%A8%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%AF%E8%83%BD%E5%85%B7%E6%9C%89%E4%BB%A5%E4%B8%8B%E7%89%B9%E6%AE%8A%E7%9A%84%E7%89%B9%E5%BE%81"><span class="toc-number">2.1.1.</span> <span class="toc-text">selenium启动的浏览器可能具有以下特殊的特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E6%83%B3%E4%BD%BF%E7%94%A8selenium%E6%AD%A3%E5%B8%B8%E8%AE%BF%E9%97%AE%EF%BC%8C%E5%88%99%E9%9C%80%E8%A6%81%E5%9C%A8%E5%88%9B%E5%BB%BAwebdriver%E6%97%B6%E9%9A%90%E8%97%8F%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9B%B8%E5%85%B3%E7%9A%84%E7%89%B9%E5%BE%81"><span class="toc-number">2.1.2.</span> <span class="toc-text">如果想使用selenium正常访问，则需要在创建webdriver时隐藏浏览器相关的特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E7%89%B9%E5%BE%81%E6%A3%80%E6%B5%8B%E6%A1%88%E4%BE%8B"><span class="toc-number">2.1.3.</span> <span class="toc-text">绕过特征检测案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JS%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-number">2.2.</span> <span class="toc-text">JS逆向分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#js%E5%8F%82%E6%95%B0%E5%8A%A0%E5%AF%86%E6%A1%88%E4%BE%8B"><span class="toc-number">2.2.1.</span> <span class="toc-text">js参数加密案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">示例代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8js%E5%8A%A0%E5%AF%86%E4%BB%A3%E7%A0%81"><span class="toc-number">2.2.2.</span> <span class="toc-text">调用js加密代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E7%A0%B4%E8%A7%A3"><span class="toc-number">2.3.</span> <span class="toc-text">验证码破解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E9%AA%8C%E8%AF%81%E7%A0%81%E7%A0%B4%E8%A7%A3"><span class="toc-number">2.3.1.</span> <span class="toc-text">图像验证码破解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAocr%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.</span> <span class="toc-text">创建ocr对象</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E5%9B%BE%E7%89%87"><span class="toc-number">4.</span> <span class="toc-text">加载图片</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%86%E5%88%AB%E5%9B%BE%E7%89%87%E5%86%85%E5%AE%B9"><span class="toc-number">5.</span> <span class="toc-text">识别图片内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#js%E9%80%86%E5%90%91%EF%BC%9A%E6%BB%91%E5%8A%A8%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9A%84%E8%BD%A8%E8%BF%B9%E7%A0%B4%E8%A7%A3"><span class="toc-number">5.0.1.</span> <span class="toc-text">js逆向：滑动验证码的轨迹破解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E7%88%AC%E8%99%AB"><span class="toc-number">5.1.</span> <span class="toc-text">异步爬虫</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%93%E5%8F%96%E9%9C%80%E6%B1%82"><span class="toc-number">5.1.1.</span> <span class="toc-text">抓取需求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">思路分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">实现思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%AD%8C%E6%9B%B2%E5%88%97%E8%A1%A8%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.1.1.3.</span> <span class="toc-text">获取歌曲列表接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BA%BF%E7%A8%8B%E4%B8%8B%E8%BD%BD"><span class="toc-number">5.1.1.4.</span> <span class="toc-text">单线程下载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E4%B8%8B%E8%BD%BD"><span class="toc-number">5.1.1.5.</span> <span class="toc-text">异步下载</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cookie%E6%B1%A0%E5%92%8CIP%E4%BB%A3%E7%90%86"><span class="toc-number">5.2.</span> <span class="toc-text">Cookie池和IP代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86IP%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">5.2.1.</span> <span class="toc-text">代理IP的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%90%86IP%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">5.2.1.1.</span> <span class="toc-text">代理IP的基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86"><span class="toc-number">5.2.1.1.1.</span> <span class="toc-text">背景：为什么要使用代理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86%E7%9A%84%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B"><span class="toc-number">5.2.1.1.2.</span> <span class="toc-text">使用代理的请求过程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%90%86IP%E7%9A%84%E8%8E%B7%E5%8F%96"><span class="toc-number">5.2.1.2.</span> <span class="toc-text">代理IP的获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%90%86IP%E5%B9%B3%E5%8F%B0"><span class="toc-number">5.2.1.3.</span> <span class="toc-text">代理IP平台</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8python%E4%BB%A3%E7%A0%81%E4%B8%AD%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86"><span class="toc-number">5.2.1.4.</span> <span class="toc-text">在python代码中如何配置代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81ip%E6%B1%A0"><span class="toc-number">5.2.1.5.</span> <span class="toc-text">动态ip池</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie%E6%B1%A0%E7%9A%84%E6%90%AD%E5%BB%BA"><span class="toc-number">5.2.2.</span> <span class="toc-text">Cookie池的搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%88%AC%E8%99%AB%E4%B8%AD%E4%BD%BF%E7%94%A8cookie%E7%9A%84%E5%88%A9%E5%BC%8A"><span class="toc-number">5.2.2.1.</span> <span class="toc-text">爬虫中使用cookie的利弊</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%A6%E4%B8%8Acookie%E5%A5%BD%E5%A4%84"><span class="toc-number">5.2.2.1.1.</span> <span class="toc-text">带上cookie好处</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%A6%E4%B8%8Acookie%E7%9A%84%E5%9D%8F%E5%A4%84"><span class="toc-number">5.2.2.2.</span> <span class="toc-text">带上cookie的坏处</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cookie%E6%B1%A0%E7%9A%84%E6%90%AD%E5%BB%BA"><span class="toc-number">5.2.2.3.</span> <span class="toc-text">cookie池的搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90-1"><span class="toc-number">5.2.2.4.</span> <span class="toc-text">思路分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie%E6%B1%A0-IP%E6%B1%A0"><span class="toc-number">5.2.3.</span> <span class="toc-text">Cookie池+IP池</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="toc-number">5.3.</span> <span class="toc-text">综合项目实战案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="toc-number">5.3.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90"><span class="toc-number">5.3.2.</span> <span class="toc-text">抓包分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90-2"><span class="toc-number">5.3.3.</span> <span class="toc-text">思路分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-1"><span class="toc-number">5.3.4.</span> <span class="toc-text">示例代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%88%AC%E5%8F%96%E6%89%80%E6%9C%89%E6%AD%8C%E6%9B%B2%E7%9A%84%E5%90%8D%E7%A7%B0%E5%92%8Cid%E6%95%B0%E6%8D%AE"><span class="toc-number">5.3.4.1.</span> <span class="toc-text">爬取所有歌曲的名称和id数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%90%84%E4%B8%AA%E6%AD%8C%E6%9B%B2%E6%BA%90%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80"><span class="toc-number">5.3.4.2.</span> <span class="toc-text">获取各个歌曲源文件的下载地址</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%A1%A5%E5%85%85%E7%9F%A5%E8%AF%86"><span class="toc-number">5.4.</span> <span class="toc-text">其他补充知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%8D%E8%B4%B9%E9%82%AE%E7%AE%B1%E8%B5%84%E6%BA%90"><span class="toc-number">5.4.1.</span> <span class="toc-text">免费邮箱资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%8D%E8%B4%B9%E4%BB%A3%E7%90%86IP%E8%B5%84%E6%BA%90"><span class="toc-number">5.4.2.</span> <span class="toc-text">免费代理IP资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E6%8C%87%E7%BA%B9%E5%8F%8D%E7%88%AC"><span class="toc-number">5.4.3.</span> <span class="toc-text">网站指纹反爬</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF-4"><span class="toc-number">5.4.3.1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="toc-number">5.4.3.2.</span> <span class="toc-text">解决办法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">5.4.3.3.</span> <span class="toc-text">参考资料</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/img/post/post_1.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Bang</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi,welcome to my <a href="https://bangwu2001.github.io">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>